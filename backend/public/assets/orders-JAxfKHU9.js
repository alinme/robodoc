import{u as B,r as y,e as c}from"./index-D6DdudHB.js";const i="/api",_=B("orders",()=>{const h=y([]),n=y(null),l=y(!1),u=y(null);async function p(){var e,s;l.value=!0,u.value=null;try{const t=await c.get(`${i}/orders`);h.value=t.data.orders||[]}catch(t){u.value=((s=(e=t.response)==null?void 0:e.data)==null?void 0:s.error)||t.message,console.error("Error fetching orders:",t)}finally{l.value=!1}}async function v(e){var s,t;l.value=!0,u.value=null;try{const a=await c.get(`${i}/orders/${e}`);return n.value=a.data.order,a.data.order}catch(a){throw u.value=((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.error)||a.message,a}finally{l.value=!1}}async function w(e){var s,t;l.value=!0,u.value=null;try{const a=await c.post(`${i}/orders`,e);return await p(),a.data.order}catch(a){throw u.value=((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.error)||a.message,a}finally{l.value=!1}}async function d(e,s){var t,a;l.value=!0,u.value=null;try{const r=await c.put(`${i}/orders/${e}`,s);return await p(),n.value&&n.value.id===e&&(n.value={...n.value,...r.data.order}),r.data.order}catch(r){throw u.value=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||r.message,r}finally{l.value=!1}}async function $(e){var s,t;l.value=!0,u.value=null;try{await c.delete(`${i}/orders/${e}`),await p(),n.value&&n.value.id===e&&(n.value=null)}catch(a){throw u.value=((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.error)||a.message,a}finally{l.value=!1}}async function g(e,s){var t,a;l.value=!0,u.value=null;try{const r=await c.post(`${i}/orders/${e}/schools`,s);return n.value&&n.value.id===e&&await v(e),r.data.school}catch(r){throw u.value=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||r.message,r}finally{l.value=!1}}async function m(e,s,t){var a,r;l.value=!0,u.value=null;try{const o=await c.put(`${i}/orders/${e}/schools/${s}`,t);return n.value&&n.value.id===e&&await v(e),o.data.school}catch(o){throw u.value=((r=(a=o.response)==null?void 0:a.data)==null?void 0:r.error)||o.message,o}finally{l.value=!1}}async function S(e,s){var t,a;l.value=!0,u.value=null;try{await c.delete(`${i}/orders/${e}/schools/${s}`),n.value&&n.value.id===e&&await v(e)}catch(r){throw u.value=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||r.message,r}finally{l.value=!1}}async function O(e,s,t){var a,r;l.value=!0,u.value=null;try{const o=await c.post(`${i}/orders/${e}/schools/${s}/structures`,t);return n.value&&n.value.id===e&&await v(e),o.data.structure}catch(o){throw u.value=((r=(a=o.response)==null?void 0:a.data)==null?void 0:r.error)||o.message,o}finally{l.value=!1}}async function x(e,s,t,a){var r,o;l.value=!0,u.value=null;try{const f=await c.put(`${i}/orders/${e}/schools/${s}/structures/${t}`,a);return n.value&&n.value.id===e&&await v(e),f.data.structure}catch(f){throw u.value=((o=(r=f.response)==null?void 0:r.data)==null?void 0:o.error)||f.message,f}finally{l.value=!1}}async function G(e,s,t){var a,r;l.value=!0,u.value=null;try{await c.delete(`${i}/orders/${e}/schools/${s}/structures/${t}`),n.value&&n.value.id===e&&await v(e)}catch(o){throw u.value=((r=(a=o.response)==null?void 0:a.data)==null?void 0:r.error)||o.message,o}finally{l.value=!1}}async function A(e,s){var t,a;l.value=!0,u.value=null;try{const r=await c.post(`${i}/orders/${e}/delivery-groups`,s);return n.value&&n.value.id===e&&await v(e),r.data.group}catch(r){throw u.value=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||r.message,r}finally{l.value=!1}}async function D(e,s,t){var a,r;l.value=!0,u.value=null;try{const o=await c.put(`${i}/orders/${e}/delivery-groups/${s}`,t);return n.value&&n.value.id===e&&await v(e),o.data.group}catch(o){throw u.value=((r=(a=o.response)==null?void 0:a.data)==null?void 0:r.error)||o.message,o}finally{l.value=!1}}async function E(e,s){var t,a;l.value=!0,u.value=null;try{await c.delete(`${i}/orders/${e}/delivery-groups/${s}`),n.value&&n.value.id===e&&await v(e)}catch(r){throw u.value=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||r.message,r}finally{l.value=!1}}async function b(e,s="json"){var t,a;try{return(await c.post(`${i}/orders/${e}/export`,{format:s})).data.data}catch(r){throw new Error(((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||r.message)}}async function k(e,s=50,t="Route"){var a,r;l.value=!0,u.value=null;try{const o=await c.post(`${i}/orders/${e}/auto-group`,{maxDistance:s,groupNamePrefix:t});return n.value&&n.value.id===e&&await v(e),o.data}catch(o){throw u.value=((r=(a=o.response)==null?void 0:a.data)==null?void 0:r.error)||o.message,o}finally{l.value=!1}}async function z(e,s){var t,a;l.value=!0,u.value=null;try{const r=await c.post(`${i}/orders/${e}/optimize-route/${s}`);return n.value&&n.value.id===e&&await v(e),r.data}catch(r){throw u.value=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||r.message,r}finally{l.value=!1}}async function R(e,s,t){var a,r;l.value=!0,u.value=null;try{const o=await c.post(`${i}/orders/${e}/bulk-assign`,{schoolIds:s,groupId:t});return n.value&&n.value.id===e&&await v(e),o.data}catch(o){throw u.value=((r=(a=o.response)==null?void 0:a.data)==null?void 0:r.error)||o.message,o}finally{l.value=!1}}async function j(e){var s,t;l.value=!0,u.value=null;try{return(await c.get(`${i}/orders/${e}/statistics`)).data}catch(a){throw u.value=((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.error)||a.message,a}finally{l.value=!1}}return{orders:h,currentOrder:n,loading:l,error:u,fetchOrders:p,fetchOrder:v,createOrder:w,updateOrder:d,deleteOrder:$,createSchool:g,updateSchool:m,deleteSchool:S,createStructure:O,updateStructure:x,deleteStructure:G,createDeliveryGroup:A,updateDeliveryGroup:D,deleteDeliveryGroup:E,exportOrder:b,autoGroupSchools:k,optimizeRoute:z,bulkAssignSchools:R,getStatistics:j}});export{_ as u};
