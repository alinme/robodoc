import{d as I,r as l,o as H,w as T,i as _,e as R,c as n,a as e,q as Q,A as G,B as K,j as k,v as E,t as r,f as U,F as P,b as B,k as O,l as W,z as X,h as d}from"./index-D6DdudHB.js";const Y={class:"px-4 py-6 sm:px-0 space-y-6"},Z={class:"flex flex-col md:flex-row md:items-end md:justify-between gap-4"},ee={class:"bg-white shadow rounded-lg p-6 space-y-4"},te={class:"text-xs text-gray-500 mt-2"},se={class:"border-t border-gray-200 pt-4 space-y-3"},oe={class:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between"},ae={key:0,class:"space-y-3"},re={class:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between"},le={class:"flex gap-2"},ne=["disabled"],de={class:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between"},ie={class:"border border-gray-200 rounded-md max-h-48 overflow-auto bg-white"},ue={key:0,class:"px-4 py-3 text-sm text-gray-500"},ce={key:1,class:"px-4 py-3 text-sm text-gray-500"},pe=["value"],me=["title"],xe={class:"bg-white shadow rounded-lg overflow-hidden"},ve={key:0,class:"p-6 text-sm text-gray-600 flex items-center gap-2"},ye={key:1,class:"p-6 text-sm text-red-600"},ge={key:2,class:"overflow-x-auto"},fe={class:"min-w-full divide-y divide-gray-200 text-sm"},be={class:"divide-y divide-gray-200"},he={class:"px-4 py-3 font-medium text-gray-900"},we={class:"px-4 py-3 text-gray-700"},_e={class:"px-4 py-3 text-gray-700"},ke={class:"px-4 py-3 text-gray-700"},Ce={class:"px-4 py-3 text-gray-500"},Se={key:0},Ne={key:3,class:"px-6 py-4 border-t border-gray-200"},Le={class:"flex flex-wrap items-center justify-between gap-4 text-sm text-gray-700"},ze={class:"flex items-center gap-3"},Re={class:"flex items-center gap-2"},Ue={class:"flex items-center gap-2"},je=["disabled"],Ve=["disabled"],Ee=I({__name:"Centralizator",setup(Me){const c=l(""),g=l(""),C=l([]),p=l(0),S=l(!1),f=l(null),u=l(50),i=l(1),b=l(!1),h=l(!1),x=l([]),m=l([]),N=l(!1);let L=null;H(async()=>{await v(),await V()}),T(c,()=>{i.value=1,L&&window.clearTimeout(L),L=window.setTimeout(()=>{v(),V()},250)}),T(u,()=>{i.value=1,v()});const z=_(()=>Math.max(1,Math.ceil(p.value/u.value))),A=_(()=>p.value===0?0:(i.value-1)*u.value+1),D=_(()=>Math.min(i.value*u.value,p.value)),j=_(()=>{if(!g.value.trim())return x.value;const a=g.value.trim().toLowerCase();return x.value.filter(t=>t.toLowerCase().includes(a))});async function v(){var a,t;S.value=!0,f.value=null;try{const{data:o}=await R.get("/api/centralizator",{params:{search:c.value||void 0,limit:u.value,offset:(i.value-1)*u.value}});C.value=o.records||[],p.value=o.total||0}catch(o){f.value=((t=(a=o.response)==null?void 0:a.data)==null?void 0:t.error)||o.message||"Failed to load records."}finally{S.value=!1}}async function V(){var a,t;N.value=!0;try{const{data:o}=await R.get("/api/centralizator/columns",{params:{search:c.value||void 0}});x.value=o.keys||[],m.value=m.value.filter(s=>x.value.includes(s))}catch(o){console.warn("Failed to load columns:",((t=(a=o.response)==null?void 0:a.data)==null?void 0:t.error)||o.message)}finally{N.value=!1}}function M(a){m.value=a?[...x.value]:[]}async function $(){var a,t;b.value=!0;try{const o=new URLSearchParams;c.value&&o.set("search",c.value),m.value.length&&o.set("columns",m.value.join(","));const s=await R.get(`/api/centralizator/export?${o.toString()}`,{responseType:"blob"}),w=window.URL.createObjectURL(new Blob([s.data])),y=document.createElement("a");y.href=w,y.setAttribute("download",`centralizator-export-${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(y),y.click(),y.remove(),window.URL.revokeObjectURL(w)}catch(o){alert("Error exporting: "+(((t=(a=o.response)==null?void 0:a.data)==null?void 0:t.error)||o.message))}finally{b.value=!1}}function F(){i.value>1&&(i.value-=1,v())}function J(){i.value<z.value&&(i.value+=1,v())}function q(a){if(!a)return"â€”";const t=new Date(a);return Number.isNaN(t.getTime())?a:t.toLocaleString()}return(a,t)=>{const o=K("router-link");return d(),n("div",Y,[e("div",Z,[t[8]||(t[8]=e("div",null,[e("h2",{class:"text-3xl font-bold text-gray-900"},"Centralizator Records"),e("p",{class:"mt-1 text-sm text-gray-500"}," All imported centralizator records across every sheet. ")],-1)),Q(o,{to:"/upload",class:"inline-flex items-center px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-md hover:bg-green-700 cursor-pointer"},{default:G(()=>[...t[7]||(t[7]=[O(" Import Centralizator ",-1)])]),_:1})]),e("div",ee,[e("div",null,[t[9]||(t[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Live search",-1)),k(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>c.value=s),type:"text",placeholder:"Search by school, address, state/region, protocol #...",class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[E,c.value,void 0,{trim:!0}]]),e("p",te,r(p.value)+" record(s) found. ",1)]),e("div",se,[e("div",oe,[t[10]||(t[10]=e("div",null,[e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Export columns"),e("p",{class:"text-xs text-gray-500"}," Base columns always included. Select extra columns from JSON. ")],-1)),e("button",{type:"button",onClick:t[1]||(t[1]=s=>h.value=!h.value),class:"px-3 py-2 bg-white border border-gray-300 text-gray-700 text-xs font-medium rounded-md hover:bg-gray-50 cursor-pointer"},r(h.value?"Hide":"Show")+" export columns ",1)]),h.value?(d(),n("div",ae,[e("div",re,[e("div",le,[e("button",{type:"button",onClick:t[2]||(t[2]=s=>M(!0)),class:"px-3 py-2 bg-white border border-gray-300 text-gray-700 text-xs font-medium rounded-md hover:bg-gray-50 cursor-pointer"}," Select all "),e("button",{type:"button",onClick:t[3]||(t[3]=s=>M(!1)),class:"px-3 py-2 bg-white border border-gray-300 text-gray-700 text-xs font-medium rounded-md hover:bg-gray-50 cursor-pointer"}," Clear ")]),e("button",{type:"button",onClick:$,disabled:b.value,class:"px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-md hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed cursor-pointer"},r(b.value?"Exporting...":"Export CSV"),9,ne)]),e("div",de,[k(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>g.value=s),type:"text",placeholder:"Search JSON columns...",class:"w-full md:max-w-sm border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[E,g.value,void 0,{trim:!0}]])]),e("div",ie,[N.value?(d(),n("div",ue," Loading columns... ")):j.value.length===0?(d(),n("div",ce," No JSON columns found. ")):(d(!0),n(P,{key:2},B(j.value,s=>(d(),n("label",{key:s,class:"flex items-center gap-2 px-4 py-2 border-b border-gray-100 last:border-b-0 cursor-pointer hover:bg-gray-50"},[k(e("input",{type:"checkbox",value:s,"onUpdate:modelValue":t[5]||(t[5]=w=>m.value=w)},null,8,pe),[[X,m.value]]),e("span",{class:"text-sm text-gray-700 truncate",title:s},r(s),9,me)]))),128))])])):U("",!0)])]),e("div",xe,[S.value?(d(),n("div",ve,[...t[11]||(t[11]=[e("span",{class:"h-4 w-4 border-2 border-gray-300 border-t-green-500 rounded-full animate-spin"},null,-1),O(" Loading records... ",-1)])])):f.value?(d(),n("div",ye,r(f.value),1)):(d(),n("div",ge,[e("table",fe,[t[13]||(t[13]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"School"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Address"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"State/Region"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Protocol #"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Updated")])],-1)),e("tbody",be,[(d(!0),n(P,null,B(C.value,s=>(d(),n("tr",{key:s.id,class:"hover:bg-gray-50"},[e("td",he,r(s.name),1),e("td",we,r(s.address||"-"),1),e("td",_e,r(s.state_region),1),e("td",ke,r(s.protocol_number||"-"),1),e("td",Ce,r(q(s.updated_at||s.created_at)),1)]))),128)),C.value.length===0?(d(),n("tr",Se,[...t[12]||(t[12]=[e("td",{colspan:"5",class:"px-4 py-6 text-center text-sm text-gray-500"}," No records found. ",-1)])])):U("",!0)])])])),p.value>0?(d(),n("div",Ne,[e("div",Le,[e("div",ze,[e("span",null,"Showing "+r(A.value)+" to "+r(D.value)+" of "+r(p.value),1),e("label",Re,[t[15]||(t[15]=e("span",null,"Show:",-1)),k(e("select",{"onUpdate:modelValue":t[6]||(t[6]=s=>u.value=s),class:"border border-gray-300 rounded-md px-2 py-1 text-sm cursor-pointer"},[...t[14]||(t[14]=[e("option",{value:20},"20",-1),e("option",{value:50},"50",-1),e("option",{value:100},"100",-1)])],512),[[W,u.value,void 0,{number:!0}]])])]),e("div",Ue,[e("button",{onClick:F,disabled:i.value===1,class:"px-3 py-1 border border-gray-300 rounded-md disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer"}," Previous ",8,je),e("span",null,"Page "+r(i.value)+" of "+r(z.value),1),e("button",{onClick:J,disabled:i.value===z.value,class:"px-3 py-1 border border-gray-300 rounded-md disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer"}," Next ",8,Ve)])])])):U("",!0)])])}}});export{Ee as default};
