import{d as xe,i as N,C as be,r as f,w as _e,o as fe,c as a,f as u,a as t,q as Q,A as X,B as ke,t as r,n as K,j as p,l as Z,m as ne,v,k as _,F,b as z,s as Y,z as oe,p as G,h as n}from"./index-D6DdudHB.js";import{u as we}from"./orders-JAxfKHU9.js";import{u as M,w as he}from"./xlsx-DrgRuPKf.js";const Se={class:"px-4 py-6 sm:px-0"},Ce={key:0,class:"text-center py-8 text-gray-500"},Ve={key:1,class:"text-center py-12 bg-white rounded-lg shadow"},$e={key:2},De={class:"mb-6"},Ae={class:"flex justify-between items-start mb-4"},Ue={class:"text-3xl font-bold text-gray-900"},Ee={class:"flex gap-2"},Ne={key:0,class:"ml-2 text-xs"},Ke={class:"bg-white shadow rounded-lg p-6 mb-6"},Me={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},Oe={class:"mt-4"},Be={class:"mt-4 grid grid-cols-4 gap-4 text-sm"},Pe={class:"ml-2 text-gray-600"},je={class:"ml-2 text-gray-600"},Ie={class:"ml-2 text-gray-600"},qe={key:0,class:"ml-2 text-xs text-gray-500"},Fe={class:"mb-4 flex justify-between items-center"},Te={class:"flex gap-2"},Le={key:0,class:"bg-white shadow rounded-lg overflow-hidden"},Je={class:"overflow-x-auto"},Re={class:"min-w-full divide-y divide-gray-200"},We={class:"bg-white divide-y divide-gray-200"},ze={class:"hover:bg-gray-50"},Ye={class:"px-4 py-3 whitespace-nowrap"},Ge={class:"flex items-center gap-2"},He=["onClick"],Qe=["onBlur","onKeyup"],Xe=["onClick"],Ze={class:"px-4 py-3"},et=["onBlur","onKeyup"],tt=["onClick"],lt={class:"px-4 py-3 whitespace-nowrap"},st=["onBlur","onKeyup"],at=["onClick"],nt={class:"px-4 py-3 whitespace-nowrap"},ot=["onBlur","onKeyup"],rt=["onClick"],dt={class:"px-4 py-3 text-sm text-gray-600"},it={key:0},ut=["onClick"],pt={key:1,class:"text-xs text-gray-500"},ct={key:2,class:"text-xs text-gray-500"},vt={key:1,class:"text-gray-400"},mt={class:"px-4 py-3 whitespace-nowrap text-sm text-gray-600"},yt={class:"px-4 py-3 whitespace-nowrap"},gt={class:"flex items-center gap-2"},xt=["checked","onChange"],bt={key:0,class:"text-xs text-green-600 font-medium",title:"Kits have been delivered to the school. You can now plan distribution."},_t={key:1,class:"text-xs text-gray-400",title:"Kits must be delivered to the school before planning can begin."},ft={class:"px-4 py-3 text-sm"},kt={class:"flex items-center gap-2"},wt={class:"text-gray-600"},ht=["onClick"],St={key:1,class:"text-xs text-gray-400"},Ct={class:"px-4 py-3 whitespace-nowrap text-sm"},Vt=["onClick"],$t=["onClick"],Dt={key:0,class:"bg-gray-50"},At={colspan:"9",class:"px-4 py-4"},Ut={class:"space-y-3"},Et={class:"flex justify-between items-center mb-3"},Nt={class:"text-sm font-medium text-gray-900"},Kt=["onClick"],Mt={key:0,class:"text-sm text-gray-500 italic py-4 text-center"},Ot={key:1,class:"space-y-2"},Bt={class:"flex-1"},Pt={class:"font-medium text-sm text-gray-900 mb-1"},jt={key:0,class:"text-xs text-gray-600 mb-1"},It={class:"flex gap-4 text-xs text-gray-600"},qt={key:0},Ft={key:1,class:"text-gray-400 italic"},Tt={key:2,class:"text-blue-600"},Lt={class:"flex gap-2 ml-4"},Jt=["onClick"],Rt=["onClick"],Wt={key:1,class:"bg-white shadow rounded-lg p-12 text-center"},zt={key:2,class:"space-y-6"},Yt={class:"flex justify-between items-start mb-4"},Gt={class:"flex-1"},Ht={class:"text-xl font-semibold text-gray-900 mb-2"},Qt={class:"text-sm text-gray-600 space-y-1"},Xt={key:0,class:"text-blue-700 font-semibold"},Zt={key:1,class:"text-red-600 font-semibold"},el={key:2},tl={key:0},ll={key:1},sl={key:0,class:"text-gray-500"},al={key:3},nl={key:4,class:"text-green-600"},ol={key:5,class:"text-xs text-gray-500 mt-1"},rl={key:6,class:"text-blue-600"},dl={class:"flex gap-2 ml-4"},il=["onClick"],ul=["onClick"],pl={key:0,class:"mt-4 pl-4 border-l-2 border-gray-200"},cl={class:"flex justify-between items-center mb-2"},vl=["onClick"],ml={key:0,class:"text-sm text-gray-500 italic"},yl={key:1,class:"space-y-2"},gl={class:"font-medium text-sm text-gray-900"},xl={key:0,class:"text-xs text-gray-600 mt-1"},bl={class:"text-xs text-gray-600 mt-1"},_l={key:1,class:"text-xs text-gray-500 mt-1"},fl={key:2,class:"text-xs text-gray-400 mt-1 italic"},kl={class:"flex gap-2"},wl=["onClick"],hl=["onClick"],Sl={class:"relative top-20 mx-auto p-6 border w-full max-w-2xl shadow-lg rounded-md bg-white max-h-[90vh] overflow-y-auto"},Cl={class:"flex justify-between items-center mb-4"},Vl={class:"text-lg font-medium text-gray-900"},$l={class:"grid grid-cols-2 gap-4"},Dl={class:"grid grid-cols-3 gap-4"},Al={class:"grid grid-cols-2 gap-4"},Ul={class:"mb-4"},El={class:"flex items-center"},Nl={class:"grid grid-cols-2 gap-4"},Kl={class:"flex justify-end gap-2 pt-4"},Ml=["disabled"],Ol={class:"relative top-20 mx-auto p-6 border w-full max-w-xl shadow-lg rounded-md bg-white"},Bl={class:"flex justify-between items-center mb-4"},Pl={class:"text-lg font-medium text-gray-900"},jl={key:0,class:"text-sm text-gray-500 mt-1"},Il={class:"bg-gray-50 p-3 rounded-md"},ql={class:"flex items-center cursor-pointer"},Fl={class:"block text-sm font-medium text-gray-700 mb-1"},Tl={key:0,class:"text-xs text-gray-500"},Ll=["disabled"],Jl={class:"block text-sm font-medium text-gray-700 mb-1"},Rl={key:0,class:"text-xs text-gray-500"},Wl=["disabled"],zl={class:"flex justify-end gap-2 pt-4"},Yl=["disabled"],Zl=xe({__name:"OrderDetail",setup(Gl){const re=be(),m=we(),x=N(()=>parseInt(re.params.id)),c=N(()=>m.currentOrder),de=N(()=>m.loading),C=f({name:"",delivery_month:null,delivery_year:null,status:"draft",notes:""}),O=f(!1),A=f(null),d=f({}),T=f(!1),L=f(!1),h=f(null),$=f(null),i=f({}),J=f(!1),U=f("table"),S=f(null),b=f({}),B=f(null),V=f(new Set),ie=N(()=>{var s;return(s=c.value)!=null&&s.schools?c.value.schools.reduce((e,y)=>{var k;return e+(((k=y.structures)==null?void 0:k.length)||0)},0):0}),ue=N(()=>{var s;return(s=c.value)!=null&&s.schools?c.value.schools.reduce((e,y)=>e+(y.calculated_kits||y.kits_count||0),0):0}),P=N(()=>{var s;return!((s=c.value)!=null&&s.schools)||c.value.schools.length===0?!1:c.value.schools.every(e=>e.kits_delivered)}),ee=N(()=>{var s;return(s=c.value)!=null&&s.schools?c.value.schools.filter(e=>!e.kits_delivered).length:0});_e(()=>c.value,s=>{s&&(C.value={name:s.name,delivery_month:s.delivery_month||null,delivery_year:s.delivery_year||null,status:s.status,notes:s.notes||""})},{immediate:!0}),fe(async()=>{await m.fetchOrder(x.value)});async function R(){try{await m.updateOrder(x.value,C.value)}catch(s){alert("Error updating order: "+(s.message||s))}}function j(s,e){S.value===s.id&&B.value===e||(S.value=s.id,B.value=e,b.value={...s})}async function D(s){if(!(!S.value||S.value!==s.id)){if(!b.value.name||!b.value.address||!b.value.city){alert("School name, address, and city are required"),S.value=null,B.value=null,b.value={};return}try{const e={...s,...b.value,is_standalone:b.value.is_standalone??s.is_standalone,kits_delivered:b.value.kits_delivered??s.kits_delivered};await m.updateSchool(x.value,s.id,e),S.value=null,B.value=null,b.value={},await m.fetchOrder(x.value)}catch(e){alert("Error updating school: "+(e.message||e)),S.value=null,B.value=null,b.value={}}}}async function pe(s,e){const y=e.target.checked;try{await m.updateSchool(x.value,s.id,{name:s.name,address:s.address,city:s.city,contact_name:s.contact_name,contact_phone:s.contact_phone,contact_email:s.contact_email,kits_count:s.kits_count,city_type:s.city_type,latitude:s.latitude,longitude:s.longitude,is_standalone:s.is_standalone,delivery_group_id:s.delivery_group_id,delivery_status:s.delivery_status,delivery_notes:s.delivery_notes,route_order:s.route_order,scheduled_start_time:s.scheduled_start_time,document_check_duration:s.document_check_duration,distribution_duration:s.distribution_duration,scheduled_end_time:s.scheduled_end_time,protocol_number:s.protocol_number,kits_delivered:y}),await m.fetchOrder(x.value)}catch(k){alert("Error updating kits delivered status: "+(k.message||k)),e.target.checked=!y}}function ce(s){V.value.has(s)?V.value.delete(s):V.value.add(s)}function te(s){A.value=s,d.value={...s,is_standalone:s.is_standalone===!0||s.is_standalone===1,kits_delivered:s.kits_delivered===!0||s.kits_delivered===1},O.value=!0}function W(){O.value=!1,A.value=null,d.value={}}async function ve(){if(!d.value.name||!d.value.address||!d.value.city){alert("School name, address, and city are required");return}if(!d.value.protocol_number||!d.value.protocol_number.trim()){alert("Protocol number is required. Distribution cannot proceed without a signed protocol/contract number.");return}T.value=!0;try{if(A.value){const s={...A.value,...d.value,is_standalone:d.value.is_standalone===!0||d.value.is_standalone===1,kits_delivered:d.value.kits_delivered===!0||d.value.kits_delivered===1};await m.updateSchool(x.value,A.value.id,s)}else{const s={...d.value,is_standalone:d.value.is_standalone===!0||d.value.is_standalone===1,kits_delivered:d.value.kits_delivered===!0||d.value.kits_delivered===1};await m.createSchool(x.value,s)}W(),await m.fetchOrder(x.value)}catch(s){alert("Error saving school: "+(s.message||s))}finally{T.value=!1}}async function le(s){if(confirm(`Are you sure you want to delete "${s.name}"? This will also delete all its structures.`))try{await m.deleteSchool(x.value,s.id),await m.fetchOrder(x.value)}catch(e){alert("Error deleting school: "+(e.message||e))}}function H(s){if(!s||!s.id){console.error("Invalid school passed to openAddStructureModal:",s),alert("Error: Invalid school selected");return}h.value={...s},$.value=null,i.value={name:"",address:null,kits_count:0,latitude:null,longitude:null,in_same_building:!1},L.value=!0}function se(s,e){if(!e||!e.id){console.error("Invalid school passed to editStructure:",e),alert("Error: Invalid school selected");return}$.value=s,h.value={...e},i.value={...s,latitude:s.latitude??null,longitude:s.longitude??null},L.value=!0}function I(){L.value=!1,h.value=null,$.value=null,i.value={name:"",address:null,kits_count:0,latitude:null,longitude:null,in_same_building:!1}}function me(){i.value.in_same_building&&h.value?(i.value.address=h.value.address||null,i.value.latitude=h.value.latitude??null,i.value.longitude=h.value.longitude??null):(i.value.latitude=null,i.value.longitude=null)}async function ye(){var k,E;if(!h.value){alert("Error: School not selected. Please try again.");return}const s=h.value.id;if(!s){alert("Error: Invalid school. Please try again."),I();return}const e=s,y={...i.value,latitude:i.value.latitude??null,longitude:i.value.longitude??null,in_same_building:i.value.in_same_building??!1};J.value=!0;try{$.value&&$.value.id?await m.updateStructure(x.value,e,$.value.id,y):await m.createStructure(x.value,e,y),V.value.has(e)||V.value.add(e),I(),await m.fetchOrder(x.value)}catch(w){console.error("Error saving structure:",w);const l=((E=(k=w==null?void 0:w.response)==null?void 0:k.data)==null?void 0:E.error)||(w==null?void 0:w.message)||"Unknown error occurred";alert("Error saving structure: "+l)}finally{J.value=!1}}async function ae(s,e){if(confirm(`Are you sure you want to delete "${s.name}"?`))try{await m.deleteStructure(x.value,e.id,s.id),await m.fetchOrder(x.value),V.value.has(e.id)||V.value.add(e.id)}catch(y){alert("Error deleting structure: "+(y.message||y))}}async function ge(){try{const s=await m.exportOrder(x.value,"xlsx"),e=M.book_new(),y=[["Order Name",s.order.name],["Delivery Month",s.order.delivery_month||""],["Delivery Year",s.order.delivery_year||""],["Status",s.order.status],["Notes",s.order.notes||""]],k=M.aoa_to_sheet(y);M.book_append_sheet(e,k,"Order");const E=s.schools.map(o=>({"School Name":o.name,Address:o.address,City:o.city,"Contact Name":o.contact_name||"","Contact Phone":o.contact_phone||"","Contact Email":o.contact_email||"","Kits Count":o.kits_count||0,"City Type":o.city_type||"","Delivery Group":o.delivery_group_name||""})),w=M.json_to_sheet(E);M.book_append_sheet(e,w,"Schools");const l=[];s.schools.forEach(o=>{(o.structures||[]).forEach(q=>{l.push({"School Name":o.name,"Structure Name":q.name,Address:q.address||"","Kits Count":q.kits_count||0})})});const g=M.json_to_sheet(l);M.book_append_sheet(e,g,"Structures"),he(e,`Order_${s.order.name.replace(/\s+/g,"_")}.xlsx`)}catch(s){alert("Error exporting order: "+(s.message||s))}}return(s,e)=>{var k,E,w;const y=ke("router-link");return n(),a("div",Se,[de.value?(n(),a("div",Ce," Loading order details... ")):c.value?(n(),a("div",$e,[t("div",De,[t("div",Ae,[t("div",null,[t("h2",Ue,r(c.value.name),1),e[32]||(e[32]=t("p",{class:"mt-1 text-sm text-gray-500"},"Manage schools, structures, and delivery planning",-1))]),t("div",Ee,[Q(y,{to:`/orders/${x.value}/planning`,class:K(["px-4 py-2 rounded-md cursor-pointer",P.value?"bg-green-600 text-white hover:bg-green-700":"bg-gray-300 text-gray-500 cursor-not-allowed"]),title:P.value?"Start delivery planning":"All schools must have kits delivered before planning"},{default:X(()=>[e[33]||(e[33]=_(" Delivery Planning ",-1)),P.value?u("",!0):(n(),a("span",Ne,"("+r(ee.value)+" waiting)",1))]),_:1},8,["to","class","title"]),t("button",{onClick:ge,class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 cursor-pointer"}," Export "),Q(y,{to:"/orders",class:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 cursor-pointer"},{default:X(()=>[...e[34]||(e[34]=[_(" Back ",-1)])]),_:1})])]),t("div",Ke,[t("div",Me,[t("div",null,[e[36]||(e[36]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Status",-1)),p(t("select",{"onUpdate:modelValue":e[0]||(e[0]=l=>C.value.status=l),onChange:R,class:"w-full border border-gray-300 rounded-md px-3 py-2"},[...e[35]||(e[35]=[ne('<option value="draft">Draft</option><option value="planned">Planned</option><option value="in-progress">In Progress</option><option value="completed">Completed</option><option value="cancelled">Cancelled</option>',5)])],544),[[Z,C.value.status]])]),t("div",null,[e[38]||(e[38]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Delivery Month",-1)),p(t("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>C.value.delivery_month=l),onChange:R,class:"w-full border border-gray-300 rounded-md px-3 py-2"},[...e[37]||(e[37]=[t("option",{value:null},"-- Select Month --",-1),ne('<option value="January">January</option><option value="February">February</option><option value="March">March</option><option value="April">April</option><option value="May">May</option><option value="June">June</option><option value="July">July</option><option value="August">August</option><option value="September">September</option><option value="October">October</option><option value="November">November</option><option value="December">December</option>',12)])],544),[[Z,C.value.delivery_month]])]),t("div",null,[e[39]||(e[39]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Delivery Year",-1)),p(t("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>C.value.delivery_year=l),onBlur:R,type:"number",min:"2020",max:"2100",class:"w-full border border-gray-300 rounded-md px-3 py-2",placeholder:"e.g., 2024"},null,544),[[v,C.value.delivery_year,void 0,{number:!0}]])])]),t("div",Oe,[e[40]||(e[40]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Notes",-1)),p(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=l=>C.value.notes=l),onBlur:R,rows:"2",class:"w-full border border-gray-300 rounded-md px-3 py-2",placeholder:"Additional notes..."},null,544),[[v,C.value.notes]])]),t("div",Be,[t("div",null,[e[41]||(e[41]=t("span",{class:"font-medium text-gray-700"},"Schools:",-1)),t("span",Pe,r(((k=c.value.schools)==null?void 0:k.length)||0),1)]),t("div",null,[e[42]||(e[42]=t("span",{class:"font-medium text-gray-700"},"Structures:",-1)),t("span",je,r(ie.value),1)]),t("div",null,[e[43]||(e[43]=t("span",{class:"font-medium text-gray-700"},"Total Kits:",-1)),t("span",Ie,r(ue.value),1)]),t("div",null,[e[44]||(e[44]=t("span",{class:"font-medium text-gray-700"},"Kits Delivered:",-1)),t("span",{class:K(["ml-2 font-semibold",P.value?"text-green-600":"text-orange-600"])},r(((E=c.value.schools)==null?void 0:E.filter(l=>l.kits_delivered).length)||0)+" / "+r(((w=c.value.schools)==null?void 0:w.length)||0),3),P.value?u("",!0):(n(),a("span",qe," ("+r(ee.value)+" waiting) ",1))])])]),t("div",Fe,[t("div",Te,[t("button",{onClick:e[4]||(e[4]=l=>U.value="table"),class:K(["px-4 py-2 rounded-md cursor-pointer",U.value==="table"?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"])}," Table View ",2),t("button",{onClick:e[5]||(e[5]=l=>U.value="cards"),class:K(["px-4 py-2 rounded-md cursor-pointer",U.value==="cards"?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"])}," Card View ",2)]),t("button",{onClick:e[6]||(e[6]=l=>O.value=!0),class:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 cursor-pointer"}," + Add School ")]),U.value==="table"&&c.value.schools&&c.value.schools.length>0?(n(),a("div",Le,[t("div",Je,[t("table",Re,[e[47]||(e[47]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"School Name"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Address"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"City"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Protocol Number"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Contact"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Kits"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},[_(" Kits at School "),t("span",{class:"text-xs font-normal text-gray-400 block"},"(Required for planning)")]),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Structures"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),t("tbody",We,[(n(!0),a(F,null,z(c.value.schools,l=>{var g;return n(),a(F,{key:l.id},[t("tr",ze,[t("td",Ye,[t("div",Ge,[l.is_standalone?u("",!0):(n(),a("button",{key:0,onClick:o=>ce(l.id),class:"text-gray-400 hover:text-gray-600"},[(n(),a("svg",{class:K(["w-4 h-4 transition-transform",{"rotate-90":V.value.has(l.id)}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...e[45]||(e[45]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])],2))],8,He)),S.value===l.id?p((n(),a("input",{key:1,"onUpdate:modelValue":e[7]||(e[7]=o=>b.value.name=o),onBlur:o=>D(l),onKeyup:G(o=>D(l),["enter"]),class:"w-full border border-gray-300 rounded-md px-2 py-1 text-sm"},null,40,Qe)),[[v,b.value.name]]):(n(),a("span",{key:2,onClick:o=>j(l,"name"),class:"cursor-pointer hover:text-blue-600"},r(l.name),9,Xe))])]),t("td",Ze,[S.value===l.id?p((n(),a("input",{key:0,"onUpdate:modelValue":e[8]||(e[8]=o=>b.value.address=o),onBlur:o=>D(l),onKeyup:G(o=>D(l),["enter"]),class:"w-full border border-gray-300 rounded-md px-2 py-1 text-sm"},null,40,et)),[[v,b.value.address]]):(n(),a("span",{key:1,onClick:o=>j(l,"address"),class:"cursor-pointer hover:text-blue-600"},r(l.address),9,tt))]),t("td",lt,[S.value===l.id?p((n(),a("input",{key:0,"onUpdate:modelValue":e[9]||(e[9]=o=>b.value.city=o),onBlur:o=>D(l),onKeyup:G(o=>D(l),["enter"]),class:"w-full border border-gray-300 rounded-md px-2 py-1 text-sm"},null,40,st)),[[v,b.value.city]]):(n(),a("span",{key:1,onClick:o=>j(l,"city"),class:"cursor-pointer hover:text-blue-600"},r(l.city),9,at))]),t("td",nt,[S.value===l.id?p((n(),a("input",{key:0,"onUpdate:modelValue":e[10]||(e[10]=o=>b.value.protocol_number=o),onBlur:o=>D(l),onKeyup:G(o=>D(l),["enter"]),placeholder:"e.g., 14.6/09.09.2025",class:"w-full border border-gray-300 rounded-md px-2 py-1 text-sm"},null,40,ot)),[[v,b.value.protocol_number]]):(n(),a("span",{key:1,onClick:o=>j(l,"protocol_number"),class:K(["cursor-pointer",l.protocol_number?"text-blue-700 font-semibold":"text-red-600"])},r(l.protocol_number||"âš  Missing"),11,rt))]),t("td",dt,[l.contact_name||l.contact_phone||l.contact_email?(n(),a("div",it,[l.contact_name?(n(),a("div",{key:0,onClick:o=>j(l,"contact_name"),class:"cursor-pointer hover:text-blue-600"},r(l.contact_name),9,ut)):u("",!0),l.contact_phone?(n(),a("div",pt,r(l.contact_phone),1)):u("",!0),l.contact_email?(n(),a("div",ct,r(l.contact_email),1)):u("",!0)])):(n(),a("span",vt,"-"))]),t("td",mt,r(l.calculated_kits||l.kits_count||0),1),t("td",yt,[t("div",gt,[t("input",{type:"checkbox",checked:l.kits_delivered||!1,onChange:o=>pe(l,o),class:"rounded border-gray-300 cursor-pointer"},null,40,xt),l.kits_delivered?(n(),a("span",bt," âœ“ Ready for Planning ")):(n(),a("span",_t," Waiting for delivery "))])]),t("td",ft,[t("div",kt,[t("span",wt,r(((g=l.structures)==null?void 0:g.length)||0),1),l.is_standalone?(n(),a("span",St,"Standalone")):(n(),a("button",{key:0,onClick:o=>H(l),class:"px-2 py-1 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 cursor-pointer text-xs"}," + Add ",8,ht))])]),t("td",Ct,[t("button",{onClick:o=>te(l),class:"px-2 py-1 bg-blue-100 text-blue-700 rounded-md hover:bg-blue-200 cursor-pointer text-xs mr-1"}," Edit ",8,Vt),t("button",{onClick:o=>le(l),class:"px-2 py-1 bg-red-100 text-red-700 rounded-md hover:bg-red-200 cursor-pointer text-xs"}," Delete ",8,$t)])]),V.value.has(l.id)&&!l.is_standalone?(n(),a("tr",Dt,[t("td",At,[t("div",Ut,[t("div",Et,[t("h4",Nt,"Structures for "+r(l.name),1),t("button",{onClick:o=>H(l),class:"px-3 py-1 bg-green-600 text-white rounded-md hover:bg-green-700 cursor-pointer text-xs"}," + Add Structure ",8,Kt)]),!l.structures||l.structures.length===0?(n(),a("div",Mt,' No structures added yet. Click "+ Add Structure" to add one. ')):(n(),a("div",Ot,[(n(!0),a(F,null,z(l.structures,o=>(n(),a("div",{key:o.id,class:"bg-white border border-gray-200 rounded-md p-3 flex justify-between items-start"},[t("div",Bt,[t("div",Pt,r(o.name),1),o.address?(n(),a("div",jt,r(o.address),1)):u("",!0),t("div",It,[t("span",null,[e[46]||(e[46]=t("span",{class:"font-medium"},"Kits:",-1)),_(" "+r(o.kits_count||0),1)]),o.latitude&&o.longitude?(n(),a("span",qt," ðŸ“ "+r(o.latitude.toFixed(6))+", "+r(o.longitude.toFixed(6)),1)):(n(),a("span",Ft,"No coordinates")),o.in_same_building?(n(),a("span",Tt,"Same building as school")):u("",!0)])]),t("div",Lt,[t("button",{onClick:q=>se(o,l),class:"px-2 py-1 bg-blue-100 text-blue-700 rounded-md hover:bg-blue-200 cursor-pointer text-xs"}," Edit ",8,Jt),t("button",{onClick:q=>ae(o,l),class:"px-2 py-1 bg-red-100 text-red-700 rounded-md hover:bg-red-200 cursor-pointer text-xs"}," Delete ",8,Rt)])]))),128))]))])])])):u("",!0)],64)}),128))])])])])):u("",!0),U.value==="cards"&&(!c.value.schools||c.value.schools.length===0)?(n(),a("div",Wt,[e[48]||(e[48]=t("p",{class:"text-gray-500 mb-4"},"No schools added yet. Add your first school to get started.",-1)),t("button",{onClick:e[11]||(e[11]=l=>O.value=!0),class:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 cursor-pointer"}," Add School ")])):u("",!0),U.value==="cards"&&c.value.schools&&c.value.schools.length>0?(n(),a("div",zt,[(n(!0),a(F,null,z(c.value.schools,l=>(n(),a("div",{key:l.id,class:"bg-white shadow rounded-lg p-6"},[t("div",Yt,[t("div",Gt,[t("h3",Ht,r(l.name),1),t("div",Qt,[t("div",null,[e[49]||(e[49]=t("span",{class:"font-medium"},"Address:",-1)),_(" "+r(l.address)+", "+r(l.city),1)]),l.protocol_number?(n(),a("div",Xt,[e[50]||(e[50]=t("span",{class:"font-medium"},"Protocol Number:",-1)),_(" "+r(l.protocol_number),1)])):(n(),a("div",Zt,[...e[51]||(e[51]=[t("span",{class:"font-medium"},"âš  Protocol Number:",-1),_(" Missing (required for distribution) ",-1)])])),l.contact_name?(n(),a("div",el,[e[52]||(e[52]=t("span",{class:"font-medium"},"Contact:",-1)),_(" "+r(l.contact_name)+" ",1),l.contact_phone?(n(),a("span",tl," - "+r(l.contact_phone),1)):u("",!0),l.contact_email?(n(),a("span",ll," - "+r(l.contact_email),1)):u("",!0)])):u("",!0),t("div",null,[e[53]||(e[53]=t("span",{class:"font-medium"},"Kits:",-1)),_(" "+r(l.calculated_kits||l.kits_count||0)+" ",1),l.structures?(n(),a("span",sl," ("+r(l.structures.length)+" structures) ",1)):u("",!0)]),l.city_type?(n(),a("div",al,[e[54]||(e[54]=t("span",{class:"font-medium"},"City Type:",-1)),_(" "+r(l.city_type),1)])):u("",!0),l.is_standalone?(n(),a("div",nl,[...e[55]||(e[55]=[t("span",{class:"font-medium"},"âœ“ Standalone School",-1),_(" (no structures) ",-1)])])):u("",!0),l.is_standalone&&l.latitude&&l.longitude?(n(),a("div",ol," ðŸ“ "+r(l.latitude.toFixed(6))+", "+r(l.longitude.toFixed(6)),1)):u("",!0),l.delivery_group_name?(n(),a("div",rl,[e[56]||(e[56]=t("span",{class:"font-medium"},"Delivery Group:",-1)),_(" "+r(l.delivery_group_name),1)])):u("",!0)])]),t("div",dl,[t("button",{onClick:g=>te(l),class:"px-3 py-1 bg-blue-100 text-blue-700 rounded-md hover:bg-blue-200 cursor-pointer text-sm"}," Edit ",8,il),t("button",{onClick:g=>le(l),class:"px-3 py-1 bg-red-100 text-red-700 rounded-md hover:bg-red-200 cursor-pointer text-sm"}," Delete ",8,ul)])]),l.is_standalone?u("",!0):(n(),a("div",pl,[t("div",cl,[e[57]||(e[57]=t("h4",{class:"text-sm font-medium text-gray-700"},"Structures",-1)),t("button",{onClick:g=>H(l),class:"px-2 py-1 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 cursor-pointer text-xs"}," + Add Structure ",8,vl)]),!l.structures||l.structures.length===0?(n(),a("div",ml," No structures added yet ")):(n(),a("div",yl,[(n(!0),a(F,null,z(l.structures,g=>(n(),a("div",{key:g.id,class:"bg-gray-50 rounded p-3 flex justify-between items-center"},[t("div",null,[t("div",gl,r(g.name),1),g.address?(n(),a("div",xl,r(g.address),1)):u("",!0),t("div",bl,[e[58]||(e[58]=t("span",{class:"font-medium"},"Kits:",-1)),_(" "+r(g.kits_count||0),1)]),g.latitude&&g.longitude?(n(),a("div",_l," ðŸ“ "+r(g.latitude.toFixed(6))+", "+r(g.longitude.toFixed(6)),1)):(n(),a("div",fl," No coordinates set "))]),t("div",kl,[t("button",{onClick:o=>se(g,l),class:"px-2 py-1 bg-blue-100 text-blue-700 rounded-md hover:bg-blue-200 cursor-pointer text-xs"}," Edit ",8,wl),t("button",{onClick:o=>ae(g,l),class:"px-2 py-1 bg-red-100 text-red-700 rounded-md hover:bg-red-200 cursor-pointer text-xs"}," Delete ",8,hl)])]))),128))]))]))]))),128))])):u("",!0)])])):(n(),a("div",Ve,[e[31]||(e[31]=t("p",{class:"text-gray-500 mb-4"},"Order not found",-1)),Q(y,{to:"/orders",class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 cursor-pointer inline-block"},{default:X(()=>[...e[30]||(e[30]=[_(" Back to Orders ",-1)])]),_:1})])),O.value||A.value?(n(),a("div",{key:3,class:"fixed inset-0 bg-gray-600/75 overflow-y-auto h-full w-full z-50",onClick:Y(W,["self"])},[t("div",Sl,[t("div",Cl,[t("h3",Vl,r(A.value?"Edit School":"Add School"),1),t("button",{type:"button",onClick:W,class:"text-gray-400 hover:text-gray-600 cursor-pointer"}," âœ• ")]),t("form",{onSubmit:Y(ve,["prevent"]),class:"space-y-4"},[t("div",$l,[t("div",null,[e[59]||(e[59]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"School Name *",-1)),p(t("input",{"onUpdate:modelValue":e[12]||(e[12]=l=>d.value.name=l),type:"text",required:"",class:"w-full border border-gray-300 rounded-md px-3 py-2",placeholder:"School name"},null,512),[[v,d.value.name]])]),t("div",null,[e[60]||(e[60]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"City *",-1)),p(t("input",{"onUpdate:modelValue":e[13]||(e[13]=l=>d.value.city=l),type:"text",required:"",class:"w-full border border-gray-300 rounded-md px-3 py-2",placeholder:"City"},null,512),[[v,d.value.city]])])]),t("div",null,[e[61]||(e[61]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Address *",-1)),p(t("input",{"onUpdate:modelValue":e[14]||(e[14]=l=>d.value.address=l),type:"text",required:"",class:"w-full border border-gray-300 rounded-md px-3 py-2",placeholder:"School address"},null,512),[[v,d.value.address]])]),t("div",null,[e[62]||(e[62]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Protocol Number *",-1)),p(t("input",{"onUpdate:modelValue":e[15]||(e[15]=l=>d.value.protocol_number=l),type:"text",required:"",class:"w-full border border-gray-300 rounded-md px-3 py-2",placeholder:"e.g., 14.6/09.09.2025"},null,512),[[v,d.value.protocol_number]]),e[63]||(e[63]=t("p",{class:"text-xs text-gray-500 mt-1"},"Required: Distribution cannot proceed without a signed protocol/contract number (format: number.number/date)",-1))]),t("div",Dl,[t("div",null,[e[64]||(e[64]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Contact Name",-1)),p(t("input",{"onUpdate:modelValue":e[16]||(e[16]=l=>d.value.contact_name=l),type:"text",class:"w-full border border-gray-300 rounded-md px-3 py-2",placeholder:"Contact name"},null,512),[[v,d.value.contact_name]])]),t("div",null,[e[65]||(e[65]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Contact Phone",-1)),p(t("input",{"onUpdate:modelValue":e[17]||(e[17]=l=>d.value.contact_phone=l),type:"tel",class:"w-full border border-gray-300 rounded-md px-3 py-2",placeholder:"Phone"},null,512),[[v,d.value.contact_phone]])]),t("div",null,[e[66]||(e[66]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Contact Email",-1)),p(t("input",{"onUpdate:modelValue":e[18]||(e[18]=l=>d.value.contact_email=l),type:"email",class:"w-full border border-gray-300 rounded-md px-3 py-2",placeholder:"Email"},null,512),[[v,d.value.contact_email]])])]),t("div",Al,[t("div",null,[e[68]||(e[68]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"City Type",-1)),p(t("select",{"onUpdate:modelValue":e[19]||(e[19]=l=>d.value.city_type=l),class:"w-full border border-gray-300 rounded-md px-3 py-2"},[...e[67]||(e[67]=[t("option",{value:null},"-- Select --",-1),t("option",{value:"urban"},"Urban",-1),t("option",{value:"rural"},"Rural",-1),t("option",{value:"urban-small"},"Urban Small",-1),t("option",{value:"urban-large"},"Urban Large",-1)])],512),[[Z,d.value.city_type]])]),t("div",null,[e[69]||(e[69]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Kits Count (informative)",-1)),p(t("input",{"onUpdate:modelValue":e[20]||(e[20]=l=>d.value.kits_count=l),type:"number",min:"0",class:"w-full border border-gray-300 rounded-md px-3 py-2",placeholder:"Rough estimate or calculated from structures"},null,512),[[v,d.value.kits_count,void 0,{number:!0}]])])]),t("div",Ul,[t("label",El,[p(t("input",{"onUpdate:modelValue":e[21]||(e[21]=l=>d.value.is_standalone=l),type:"checkbox",class:"mr-2 rounded border-gray-300"},null,512),[[oe,d.value.is_standalone]]),e[70]||(e[70]=t("span",{class:"text-sm font-medium text-gray-700"},"Standalone School (no structures - deliver directly to school)",-1))])]),t("div",Nl,[t("div",null,[e[71]||(e[71]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Latitude (for map - optional for standalone)",-1)),p(t("input",{"onUpdate:modelValue":e[22]||(e[22]=l=>d.value.latitude=l),type:"number",step:"any",class:"w-full border border-gray-300 rounded-md px-3 py-2",placeholder:"Optional"},null,512),[[v,d.value.latitude,void 0,{number:!0}]])]),t("div",null,[e[72]||(e[72]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Longitude (for map - optional for standalone)",-1)),p(t("input",{"onUpdate:modelValue":e[23]||(e[23]=l=>d.value.longitude=l),type:"number",step:"any",class:"w-full border border-gray-300 rounded-md px-3 py-2",placeholder:"Optional"},null,512),[[v,d.value.longitude,void 0,{number:!0}]])])]),t("div",Kl,[t("button",{type:"button",onClick:W,class:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 cursor-pointer"}," Cancel "),t("button",{type:"submit",disabled:T.value,class:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 cursor-pointer disabled:bg-gray-400 disabled:cursor-not-allowed"},r(T.value?"Saving...":"Save School"),9,Ml)])],32)])])):u("",!0),L.value||$.value?(n(),a("div",{key:4,class:"fixed inset-0 bg-gray-600/75 overflow-y-auto h-full w-full z-50",onClick:Y(I,["self"])},[t("div",Ol,[t("div",Bl,[t("div",null,[t("h3",Pl,r($.value?"Edit Structure":"Add Structure"),1),h.value?(n(),a("p",jl," School: "+r(h.value.name),1)):u("",!0)]),t("button",{type:"button",onClick:I,class:"text-gray-400 hover:text-gray-600 cursor-pointer"}," âœ• ")]),t("form",{onSubmit:Y(ye,["prevent"]),class:"space-y-4"},[t("div",null,[e[73]||(e[73]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Structure Name *",-1)),p(t("input",{"onUpdate:modelValue":e[24]||(e[24]=l=>i.value.name=l),type:"text",required:"",class:"w-full border border-gray-300 rounded-md px-3 py-2",placeholder:"e.g., Kindergarten A"},null,512),[[v,i.value.name]])]),t("div",null,[e[74]||(e[74]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Address",-1)),p(t("input",{"onUpdate:modelValue":e[25]||(e[25]=l=>i.value.address=l),type:"text",class:"w-full border border-gray-300 rounded-md px-3 py-2",placeholder:"Structure address (city inherited from school)"},null,512),[[v,i.value.address]])]),t("div",null,[e[75]||(e[75]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Number of Kids/Kits",-1)),p(t("input",{"onUpdate:modelValue":e[26]||(e[26]=l=>i.value.kits_count=l),type:"number",min:"0",class:"w-full border border-gray-300 rounded-md px-3 py-2",placeholder:"Will be confirmed later (optional for now)"},null,512),[[v,i.value.kits_count,void 0,{number:!0}]])]),t("div",Il,[t("label",ql,[p(t("input",{"onUpdate:modelValue":e[27]||(e[27]=l=>i.value.in_same_building=l),type:"checkbox",class:"rounded mr-2",onChange:me},null,544),[[oe,i.value.in_same_building]]),e[76]||(e[76]=t("span",{class:"text-sm font-medium text-gray-700"},"In Same Building as School",-1))]),e[77]||(e[77]=t("p",{class:"text-xs text-gray-500 mt-1 ml-6"}," If checked, this structure will use the school's address and map coordinates ",-1))]),t("div",{class:K(["grid grid-cols-2 gap-4",{"opacity-50":i.value.in_same_building}])},[t("div",null,[t("label",Fl,[e[78]||(e[78]=_(" Latitude (for map) ",-1)),i.value.in_same_building?(n(),a("span",Tl,"(using school's)")):u("",!0)]),p(t("input",{"onUpdate:modelValue":e[28]||(e[28]=l=>i.value.latitude=l),type:"number",step:"any",disabled:i.value.in_same_building,class:"w-full border border-gray-300 rounded-md px-3 py-2 disabled:bg-gray-100",placeholder:"Optional"},null,8,Ll),[[v,i.value.latitude,void 0,{number:!0}]])]),t("div",null,[t("label",Jl,[e[79]||(e[79]=_(" Longitude (for map) ",-1)),i.value.in_same_building?(n(),a("span",Rl,"(using school's)")):u("",!0)]),p(t("input",{"onUpdate:modelValue":e[29]||(e[29]=l=>i.value.longitude=l),type:"number",step:"any",disabled:i.value.in_same_building,class:"w-full border border-gray-300 rounded-md px-3 py-2 disabled:bg-gray-100",placeholder:"Optional"},null,8,Wl),[[v,i.value.longitude,void 0,{number:!0}]])])],2),t("div",zl,[t("button",{type:"button",onClick:I,class:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 cursor-pointer"}," Cancel "),t("button",{type:"submit",disabled:J.value,class:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 cursor-pointer disabled:bg-gray-400 disabled:cursor-not-allowed"},r(J.value?"Saving...":"Save Structure"),9,Yl)])],32)])])):u("",!0)])}}});export{Zl as default};
