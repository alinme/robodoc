import{d as Ze,r as u,i as w,o as et,e as se,w as ae,c as s,f as c,a as l,q as tt,k as m,t as d,F as x,b,j as _,l as ne,v as T,y as lt,n as ge,z as ot,h as a}from"./index-D6DdudHB.js";import{u as ye,w as st}from"./xlsx-DrgRuPKf.js";import{_ as at}from"./FileUpload.vue_vue_type_script_setup_true_lang-BaW8ujYT.js";const nt={class:"space-y-6"},rt={key:0},ut={class:"bg-white shadow rounded-lg p-6"},dt={key:0,class:"mt-2 text-sm text-gray-500"},it={class:"font-medium text-gray-700"},ct={class:"bg-white shadow rounded-lg p-6 space-y-4"},vt={key:0,class:"bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded"},mt={key:1,class:"text-sm text-gray-600 flex items-center gap-2"},pt={key:2,class:"text-sm text-gray-500"},gt={key:3,class:"space-y-3"},yt={class:"space-y-1"},xt={class:"text-sm font-medium text-gray-900"},ft={class:"text-xs text-gray-500"},bt={key:0,class:"mx-1"},ht={key:1},wt={class:"flex flex-wrap gap-2"},_t=["onClick","disabled"],kt={key:0,class:"flex items-center gap-2"},Ct={key:1},St=["onClick","disabled"],Ft={key:0,class:"flex items-center gap-2"},Nt={key:1},Vt={key:4,class:"mt-3"},$t={key:1,class:"bg-white shadow rounded-lg p-6 space-y-6"},Pt={class:"space-y-2"},Ut=["value"],At={class:"text-sm text-gray-700"},Lt={class:"text-gray-500"},Et={key:0,class:"space-y-4"},Mt={class:"max-w-xs"},zt=["value"],Bt={class:"space-y-3"},It={class:"overflow-x-auto border border-gray-200 rounded-md max-h-80"},Rt={class:"min-w-full text-xs"},Dt={class:"bg-gray-50 sticky top-0"},Tt={class:"px-2 py-1 border border-gray-200 font-medium"},qt={key:0,class:"text-green-600 ml-1"},jt={class:"flex flex-col sm:flex-row sm:items-center gap-3 pt-4 border-t border-gray-100"},Ot=["disabled"],Ht={key:0,class:"flex items-center gap-2"},Yt={key:1},Gt={key:0,class:"text-sm text-red-600"},Kt={key:2,class:"bg-white shadow rounded-lg p-6 space-y-6"},Qt={class:"flex flex-col lg:flex-row lg:items-end gap-4"},Jt={class:"flex-1"},Wt={class:"flex gap-3 flex-wrap"},Xt={key:0,class:"ml-1 text-xs text-green-600 font-semibold"},Zt={key:0,class:"ml-1 text-xs text-green-600 font-semibold"},el={key:0,class:"flex items-end gap-2"},tl=["disabled"],ll={key:0,class:"text-sm text-red-600"},ol={key:1,class:"bg-gray-50 border border-gray-200 rounded-lg p-4 space-y-3"},sl={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-3"},al={class:"flex items-center gap-2"},nl={class:"text-xs text-gray-500"},rl={class:"flex gap-2"},ul={class:"border border-gray-200 rounded-md max-h-56 overflow-auto bg-white divide-y divide-gray-100"},dl=["checked","onChange"],il=["title"],cl={key:0,class:"px-4 py-3 text-sm text-gray-500"},vl={key:0,class:"text-sm text-red-600"},ml={key:2,class:"bg-gray-50 border border-gray-200 rounded-lg p-4 space-y-4"},pl={class:"flex flex-wrap gap-4 items-end"},gl={class:"min-w-[200px]"},yl=["value"],xl={class:"min-w-[180px]"},fl={class:"min-w-[160px]"},bl={class:"min-w-[220px] flex-1"},hl={key:0,class:"space-y-3"},wl={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-3"},_l={class:"text-sm font-medium text-gray-700"},kl={class:"font-semibold text-gray-900"},Cl={class:"border border-gray-200 rounded-md max-h-56 overflow-auto bg-white"},Sl={key:0,class:"px-4 py-3 text-sm text-gray-500"},Fl=["value"],Nl={class:"text-sm text-gray-700 truncate"},Vl={key:1,class:"text-xs text-gray-500"},$l={key:2,class:"text-sm text-red-600"},Pl={key:3,class:"flex flex-wrap items-center gap-2"},Ul=["onClick"],Al={class:"flex flex-wrap gap-6 text-sm text-gray-600"},Ll={class:"font-medium text-gray-900"},El={class:"font-medium text-gray-900"},Ml={class:"font-medium text-green-700"},zl={class:"font-medium text-red-600"},Bl={class:"font-medium text-gray-600"},Il={class:"scroll-container overflow-auto border border-gray-200 rounded-lg max-h-[calc(100vh-220px)]"},Rl={class:"min-w-max table-auto divide-y divide-gray-200 text-sm"},Dl={class:"bg-gray-50"},Tl=["title"],ql={key:0,class:"ml-1 text-xs text-green-600 bg-green-50 border border-green-100 rounded px-1 py-0.5"},jl={class:"divide-y divide-gray-200"},Ol={key:0,class:"flex gap-2"},Hl=["onClick"],Yl=["onUpdate:modelValue"],Gl={key:2,class:"text-gray-800"},Kl={class:"px-3 py-2"},Ql=["onClick"],Jl={key:0},Wl=["colspan"],Xl=Ze({__name:"ProtocolCheck",props:{hideHeader:{type:Boolean}},setup(K){const q=u(null),$=u(""),M=u([]),k=u(""),z=u(1),i=u([]),re=u([]),P=u([]),f=u([]),Q=u(!1),S=u(null),j=u(""),J=u(!1),B=u("Protocol"),U=u(null),O=u(!1),p=u(""),h=u("text"),W=u("contains"),A=u(""),C=u(""),F=u([]),N=u(null),g=u([]),ue=u(1),I=u(!1),L=u(""),v=u([]),V=u(null),R=u([]),de=u(!1),X=u(null),H=u(null),Z=u(!1),ee=u(null),ie=w(()=>M.value.find(t=>t.name===k.value)??null),ce=w(()=>{var t;return((t=ie.value)==null?void 0:t.preview)??null}),Ce=w(()=>{if(!ie.value)return[1];const t=Math.min(10,ie.value.totalRows);return Array.from({length:t},(e,n)=>n+1)}),Se=w(()=>Z.value?R.value:R.value.slice(0,3)),Fe=w(()=>i.value.length>0&&f.value.length>=0),xe=w(()=>{if(!p.value)return[];const t=new Set;return f.value.forEach(n=>{const o=n.data[p.value],r=o==null?"":String(o);t.has(r)||t.add(r)}),Array.from(t).sort((n,o)=>n.localeCompare(o))}),fe=w(()=>{if(!C.value.trim())return xe.value;const t=C.value.trim().toLowerCase();return xe.value.filter(e=>e.toLowerCase().includes(t))}),te=w(()=>{let t=f.value;if(j.value.trim()){const e=j.value.trim().toLowerCase();t=t.filter(n=>i.value.some(o=>{const r=n.data[o];return r!=null&&String(r).toLowerCase().includes(e)}))}return g.value.length&&(t=t.filter(e=>g.value.every(n=>{var le;const o=e.data[n.column],r=o==null?"":String(o),y=r.toLowerCase(),G=r.trim();if(n.mode==="empty")return G==="";if(n.mode==="not_empty")return G!=="";if(n.mode==="values"&&((le=n.values)!=null&&le.length))return n.values.map(oe=>oe.toLowerCase()).includes(y);if(n.mode==="text"&&n.value){const D=n.value.toLowerCase();switch(n.operator){case"equals":return y===D;case"contains":default:return y.includes(D)}}return!0}))),t}),E=w(()=>i.value.filter(t=>!v.value.includes(t))),be=w(()=>{if(!L.value.trim())return i.value;const t=L.value.trim().toLowerCase();return i.value.filter(e=>e.toLowerCase().includes(t))}),ve=w(()=>i.value.find(e=>e.toLowerCase()==="protocol")??"Protocol"),me=w(()=>{let t=0,e=0,n=0;return f.value.forEach(o=>{const r=_e(o);r==="Yes"?t+=1:r==="No"?e+=1:n+=1}),{yes:t,no:e,na:n}}),Ne=["Yes","N/A","No"];et(async()=>{await Y()});function he(t){var e;q.value=t.fileId,$.value=t.fileName,M.value=t.sheets,k.value=((e=t.sheets[0])==null?void 0:e.name)??"",z.value=1,i.value=[],re.value=[],P.value=[],f.value=[],S.value=null,j.value="",p.value=i.value[0]??"",h.value="text",W.value="contains",A.value="",C.value="",F.value=[],g.value=[],v.value=[],O.value=!1,I.value=!1,L.value=""}async function Ve(t){he(t),await Y()}async function Y(){var t,e;de.value=!0,H.value=null;try{const{data:n}=await se.get("/api/upload/files");n.success?R.value=n.files:H.value="Failed to load stored files."}catch(n){H.value=((e=(t=n.response)==null?void 0:t.data)==null?void 0:e.error)||n.message||"Failed to load stored files."}finally{de.value=!1}}async function $e(t){var e,n;X.value=t,S.value=null;try{const{data:o}=await se.get(`/api/upload/files/${t}`);he(o)}catch(o){S.value=((n=(e=o.response)==null?void 0:e.data)==null?void 0:n.error)||o.message||"Failed to load the stored file.",await Y()}finally{X.value=null}}async function Pe(t){var e,n;if(confirm("Delete this uploaded file?")){ee.value=t;try{await se.delete(`/api/upload/files/${t}`),await Y()}catch(o){S.value=((n=(e=o.response)==null?void 0:e.data)==null?void 0:n.error)||o.message||"Failed to delete the stored file."}finally{ee.value=null}}}function Ue(t){if(!t)return"Unknown date";const e=new Date(t);return Number.isNaN(e.getTime())?t:e.toLocaleString()}function Ae(t){if(t==null||t<=0)return"Unknown size";const e=["B","KB","MB","GB","TB"],n=Math.min(Math.floor(Math.log(t)/Math.log(1024)),e.length-1),o=t/Math.pow(1024,n);return`${o.toFixed(o>=10||n===0?0:1)} ${e[n]}`}async function Le(){var t,e;if(!q.value||!k.value){S.value="Please upload a file and select a sheet.";return}Q.value=!0,S.value=null;try{const o=(await se.post("/api/protocol/data",{fileId:q.value,sheetName:k.value,headerRow:z.value})).data;i.value=[...o.headers],re.value=[...o.headers],P.value=[],f.value=o.rows.map(r=>({id:r.id,originalRowNumber:r.originalRowNumber,data:{...r.data}})),Ee(),g.value=g.value.filter(r=>i.value.includes(r.column)),p.value=i.value[0]??"",C.value="",F.value=[],v.value=[],I.value=!1,L.value=""}catch(n){S.value=((e=(t=n.response)==null?void 0:t.data)==null?void 0:e.error)||n.message||"Failed to load sheet data."}finally{Q.value=!1}}function Ee(){const t=ve.value;i.value.includes(t)?!re.value.includes(t)&&!P.value.includes(t)&&P.value.push(t):(i.value.push(t),P.value.push(t)),f.value=f.value.map(e=>({...e,data:{...e.data,[t]:we(e.data[t])}}))}function Me(){J.value=!0,U.value=null,B.value="Protocol"}function ze(){J.value=!1,U.value=null,B.value="Protocol"}function Be(){const t=B.value.trim();if(!t){U.value="Column name cannot be empty.";return}if(i.value.some(n=>n.toLowerCase()===t.toLowerCase())){U.value=`A column named "${t}" already exists.`;return}i.value.push(t),P.value.push(t),f.value=f.value.map(n=>({...n,data:{...n.data,[t]:""}})),J.value=!1,U.value=null,B.value="Protocol"}function pe(t){return t.toLowerCase()==="protocol"}function Ie(t){return P.value.includes(t)||pe(t)}function Re(t){return t==null?"":typeof t=="string"?t:String(t)}function De(t){f.value=f.value.filter(e=>e.id!==t)}function Te(){const t=te.value,e=E.value;if(!e.length||!t.length){alert("No data to export. Please ensure you have visible rows and columns.");return}const n=t.map(le=>{const D={};return e.forEach(oe=>{D[oe]=le.data[oe]??""}),D}),o=ye.json_to_sheet(n,{header:e}),r=ye.book_new();ye.book_append_sheet(r,o,k.value||"Protocol");const G=`${$.value.replace(/\.[^.]+$/,"")||"protocol-check"}-review.xlsx`;st(r,G)}function we(t){const e=String(t??"").trim().toLowerCase();return e==="yes"?"Yes":e==="no"?"No":"N/A"}function _e(t){const e=ve.value;return we(t.data[e])}function qe(t,e){const n=ve.value;t.data={...t.data,[n]:e}}function je(){O.value=!O.value,O.value&&!p.value&&(p.value=i.value[0]??""),N.value=null,C.value=""}function Oe(){if(N.value=null,!p.value){N.value="Please choose a column to filter.";return}if(h.value==="text"){if(!A.value.trim()){N.value="Filter value cannot be empty.";return}g.value.push({id:ue.value++,column:p.value,mode:"text",operator:W.value,value:A.value.trim()}),A.value=""}else if(h.value==="values"){if(!F.value.length){N.value="Select at least one value.";return}g.value.push({id:ue.value++,column:p.value,mode:"values",values:[...F.value]}),F.value=[]}else g.value.push({id:ue.value++,column:p.value,mode:h.value});C.value=""}function He(t){g.value=g.value.filter(e=>e.id!==t)}function Ye(){g.value=[]}function Ge(t){return g.value.some(e=>e.column===t)}function Ke(){I.value=!I.value,V.value=null,I.value&&(L.value="")}function Qe(t){return v.value.includes(t)}function Je(t){if(V.value=null,v.value.includes(t)){v.value=v.value.filter(e=>e!==t);return}if(E.value.length<=1){V.value="At least one column must remain visible.";return}v.value=[...v.value,t]}function We(){v.value=[],V.value=null}function ke(t){return t||"(Blank)"}function Xe(t){var n;if(t.mode==="values"){const o=(n=t.values)!=null&&n.length?t.values.map(ke).join(", "):"Any";return`${t.column} ∈ [${o}]`}if(t.mode==="empty")return`${t.column} is empty`;if(t.mode==="not_empty")return`${t.column} is not empty`;const e=t.operator==="equals"?"=":"contains";return`${t.column} ${e} "${t.value??""}"`}return ae(p,()=>{F.value=[],C.value="",N.value=null}),ae(h,()=>{A.value="",F.value=[],C.value="",N.value=null}),ae(i,()=>{v.value=v.value.filter(t=>i.value.includes(t)),i.value.includes(p.value)||(p.value=i.value[0]??""),E.value.length===0&&i.value.length&&(v.value=[]),V.value=null}),ae(v,t=>{if(E.value.length===0&&i.value.length){const e=t.slice(0,Math.max(0,t.length-1));v.value=e,V.value="At least one column must remain visible."}}),(t,e)=>{var n;return a(),s("div",nt,[K.hideHeader?c("",!0):(a(),s("section",rt,[...e[12]||(e[12]=[l("h2",{class:"text-3xl font-bold text-gray-900"},"Protocol Check",-1),l("p",{class:"mt-1 text-sm text-gray-500"}," Upload the provided Excel file, review each institution, and record whether the protocol contract is signed. You can search, delete rows, add custom columns, and export the updated sheet once you finish. ",-1)])])),l("section",ut,[e[14]||(e[14]=l("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"1. Upload File",-1)),tt(at,{onFileUploaded:Ve}),$.value?(a(),s("p",dt,[e[13]||(e[13]=m(" Selected file: ",-1)),l("span",it,d($.value),1)])):c("",!0)]),l("section",ct,[l("div",{class:"flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between"},[e[15]||(e[15]=l("div",null,[l("h3",{class:"text-lg font-medium text-gray-900"},"2. Or Select an Existing File"),l("p",{class:"text-sm text-gray-500"}," Quickly reopen a previously uploaded workbook. Your protocol decisions stay in the exported file. ")],-1)),l("button",{type:"button",onClick:Y,class:"self-start px-3 py-2 bg-white border border-gray-300 text-gray-700 text-sm font-medium rounded-md hover:bg-gray-50 cursor-pointer"}," Refresh ")]),H.value?(a(),s("div",vt,d(H.value),1)):de.value?(a(),s("div",mt,[...e[16]||(e[16]=[l("span",{class:"h-4 w-4 border-2 border-gray-300 border-t-green-500 rounded-full animate-spin"},null,-1),m(" Loading files... ",-1)])])):R.value.length===0?(a(),s("div",pt," No stored files yet. Upload a file to populate this list. ")):(a(),s("ul",gt,[(a(!0),s(x,null,b(Se.value,o=>(a(),s("li",{key:o.fileId,class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 border border-gray-200 rounded-md px-4 py-3"},[l("div",yt,[l("p",xt,d(o.originalName),1),l("p",ft,[m(" Uploaded "+d(Ue(o.uploadedAt))+" ",1),o.sizeBytes?(a(),s("span",bt,"•")):c("",!0),o.sizeBytes?(a(),s("span",ht,d(Ae(o.sizeBytes)),1)):c("",!0)])]),l("div",wt,[l("button",{type:"button",onClick:r=>$e(o.fileId),class:"px-3 py-2 bg-green-600 text-white text-sm font-medium rounded-md hover:bg-green-700 cursor-pointer disabled:bg-gray-400 disabled:cursor-not-allowed",disabled:X.value===o.fileId},[X.value===o.fileId?(a(),s("span",kt,[...e[17]||(e[17]=[l("span",{class:"h-3 w-3 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1),m(" Loading... ",-1)])])):(a(),s("span",Ct,"Load File"))],8,_t),l("button",{type:"button",onClick:r=>Pe(o.fileId),class:"px-3 py-2 bg-red-600 text-white text-sm font-medium rounded-md hover:bg-red-700 cursor-pointer disabled:bg-gray-400 disabled:cursor-not-allowed",disabled:ee.value===o.fileId},[ee.value===o.fileId?(a(),s("span",Ft,[...e[18]||(e[18]=[l("span",{class:"h-3 w-3 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1),m(" Deleting... ",-1)])])):(a(),s("span",Nt,"Delete"))],8,St)])]))),128))])),R.value.length>3?(a(),s("div",Vt,[l("button",{type:"button",onClick:e[0]||(e[0]=o=>Z.value=!Z.value),class:"text-sm text-green-700 hover:text-green-800 font-semibold"},d(Z.value?"Show less":`Show more (${R.value.length-3} more)`),1)])):c("",!0)]),M.value.length?(a(),s("section",$t,[l("div",null,[e[19]||(e[19]=l("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"3. Select Sheet",-1)),l("div",Pt,[(a(!0),s(x,null,b(M.value,o=>(a(),s("label",{key:o.name,class:"flex items-center gap-3"},[_(l("input",{type:"radio",value:o.name,"onUpdate:modelValue":e[1]||(e[1]=r=>k.value=r),class:"cursor-pointer"},null,8,Ut),[[lt,k.value]]),l("span",At,[m(d(o.name)+" ",1),l("span",Lt,"("+d(o.rowCount)+" rows)",1)])]))),128))])]),ce.value?(a(),s("div",Et,[l("div",null,[e[21]||(e[21]=l("h3",{class:"text-lg font-medium text-gray-900 mb-3"},"4. Choose Header Row",-1)),l("div",Mt,[e[20]||(e[20]=l("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Header row ",-1)),_(l("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>z.value=o),class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500"},[(a(!0),s(x,null,b(Ce.value,o=>(a(),s("option",{key:o,value:o}," Row "+d(o),9,zt))),128))],512),[[ne,z.value,void 0,{number:!0}]])])]),l("div",Bt,[e[23]||(e[23]=l("p",{class:"text-sm font-medium text-gray-700"},"Preview (first 10 rows):",-1)),l("div",It,[l("table",Rt,[l("thead",Dt,[l("tr",null,[e[22]||(e[22]=l("th",{class:"px-2 py-1 text-left border border-gray-200 bg-gray-50"},"Row #",-1)),(a(!0),s(x,null,b(((n=ce.value[0])==null?void 0:n.cells)||[],(o,r)=>(a(),s("th",{key:r,class:"px-2 py-1 text-left border border-gray-200 bg-gray-50"}," Col "+d(r+1),1))),128))])]),l("tbody",null,[(a(!0),s(x,null,b(ce.value,o=>(a(),s("tr",{key:o.rowNumber,class:ge({"bg-green-50 font-semibold":o.rowNumber===z.value})},[l("td",Tt,[m(d(o.rowNumber)+" ",1),o.rowNumber===z.value?(a(),s("span",qt," ✓ Headers ")):c("",!0)]),(a(!0),s(x,null,b(o.cells,(r,y)=>(a(),s("td",{key:y,class:"px-2 py-1 border border-gray-200"},d(r||"-"),1))),128))],2))),128))])])]),e[24]||(e[24]=l("p",{class:"text-xs text-gray-500"}," Confirm the highlighted row contains your column names before loading the sheet. ",-1))]),l("div",jt,[l("button",{type:"button",onClick:Le,disabled:!k.value||Q.value,class:"inline-flex items-center justify-center px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-md hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed cursor-pointer"},[Q.value?(a(),s("span",Ht,[...e[25]||(e[25]=[l("span",{class:"h-4 w-4 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1),m(" Loading... ",-1)])])):(a(),s("span",Yt,"Load Sheet Data"))],8,Ot),S.value?(a(),s("p",Gt,d(S.value),1)):c("",!0)])])):c("",!0)])):c("",!0),Fe.value?(a(),s("section",Kt,[l("div",Qt,[l("div",Jt,[e[26]||(e[26]=l("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Search",-1)),_(l("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>j.value=o),type:"text",placeholder:"Search across all columns...",class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[T,j.value,void 0,{trim:!0}]])]),l("div",Wt,[l("button",{type:"button",onClick:je,class:"px-4 py-2 bg-white border border-gray-300 text-gray-700 text-sm font-medium rounded-md hover:bg-gray-50 cursor-pointer"},[e[27]||(e[27]=m(" Filters ",-1)),g.value.length?(a(),s("span",Xt," ("+d(g.value.length)+") ",1)):c("",!0)]),l("button",{type:"button",onClick:Ke,class:"px-4 py-2 bg-white border border-gray-300 text-gray-700 text-sm font-medium rounded-md hover:bg-gray-50 cursor-pointer"},[e[28]||(e[28]=m(" Columns ",-1)),v.value.length?(a(),s("span",Zt," ("+d(i.value.length-v.value.length)+"/"+d(i.value.length)+") ",1)):c("",!0)]),J.value?(a(),s("div",el,[l("div",null,[e[29]||(e[29]=l("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"New column name",-1)),_(l("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>B.value=o),type:"text",class:"border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500",placeholder:"e.g. Protocol"},null,512),[[T,B.value]])]),l("div",{class:"flex gap-2 pb-1"},[l("button",{type:"button",onClick:Be,class:"px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-md hover:bg-green-700 cursor-pointer"}," Save "),l("button",{type:"button",onClick:ze,class:"px-4 py-2 bg-gray-200 text-gray-700 text-sm font-medium rounded-md hover:bg-gray-300 cursor-pointer"}," Cancel ")])])):(a(),s("button",{key:1,type:"button",onClick:Me,class:"px-4 py-2 bg-white border border-gray-300 text-gray-700 text-sm font-medium rounded-md hover:bg-gray-50 cursor-pointer"}," Add Column ")),l("button",{type:"button",onClick:Te,disabled:!f.value.length,class:"px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-md hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed cursor-pointer"}," Download Updated Excel ",8,tl)])]),U.value?(a(),s("p",ll,d(U.value),1)):c("",!0),I.value?(a(),s("div",ol,[l("div",sl,[l("div",al,[e[30]||(e[30]=l("label",{class:"text-sm font-medium text-gray-700"},"Visible columns",-1)),l("span",nl,d(i.value.length-v.value.length)+" of "+d(i.value.length)+" shown ",1)]),l("div",rl,[_(l("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>L.value=o),type:"text",placeholder:"Search columns...",class:"w-full md:w-64 border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[T,L.value]]),l("button",{type:"button",onClick:We,class:"px-4 py-2 bg-white border border-gray-300 text-gray-700 text-sm font-medium rounded-md hover:bg-gray-50 cursor-pointer"}," Show all ")])]),l("div",ul,[(a(!0),s(x,null,b(be.value,o=>(a(),s("label",{key:`column-toggle-${o}`,class:"flex items-center gap-3 px-4 py-2 cursor-pointer hover:bg-gray-50"},[l("input",{type:"checkbox",checked:!Qe(o),onChange:r=>Je(o)},null,40,dl),l("span",{class:"text-sm text-gray-700 truncate",title:o},d(o),9,il)]))),128)),be.value.length?c("",!0):(a(),s("div",cl," No columns match your search. "))]),V.value?(a(),s("p",vl,d(V.value),1)):c("",!0),e[31]||(e[31]=l("p",{class:"text-xs text-gray-500"}," Hidden columns stay in the export — this only affects what you see on screen. ",-1))])):c("",!0),O.value?(a(),s("div",ml,[l("div",pl,[l("div",gl,[e[33]||(e[33]=l("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Column",-1)),_(l("select",{"onUpdate:modelValue":e[6]||(e[6]=o=>p.value=o),class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500"},[e[32]||(e[32]=l("option",{value:"",disabled:""},"Select column",-1)),(a(!0),s(x,null,b(i.value,o=>(a(),s("option",{key:`filter-${o}`,value:o},d(o),9,yl))),128))],512),[[ne,p.value]])]),l("div",xl,[e[35]||(e[35]=l("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Filter type",-1)),_(l("select",{"onUpdate:modelValue":e[7]||(e[7]=o=>h.value=o),class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500"},[...e[34]||(e[34]=[l("option",{value:"text"},"Text match",-1),l("option",{value:"values"},"Select values",-1),l("option",{value:"empty"},"Is empty",-1),l("option",{value:"not_empty"},"Is not empty",-1)])],512),[[ne,h.value]])]),h.value==="text"?(a(),s(x,{key:0},[l("div",fl,[e[37]||(e[37]=l("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Match",-1)),_(l("select",{"onUpdate:modelValue":e[8]||(e[8]=o=>W.value=o),class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500"},[...e[36]||(e[36]=[l("option",{value:"contains"},"Contains",-1),l("option",{value:"equals"},"Equals",-1)])],512),[[ne,W.value]])]),l("div",bl,[e[38]||(e[38]=l("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Value",-1)),_(l("input",{"onUpdate:modelValue":e[9]||(e[9]=o=>A.value=o),type:"text",placeholder:"Enter filter value",class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[T,A.value]])])],64)):c("",!0),l("button",{type:"button",onClick:Oe,class:"px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-md hover:bg-green-700 cursor-pointer"}," Add filter ")]),h.value==="values"?(a(),s("div",hl,[l("div",wl,[l("label",_l,[e[39]||(e[39]=m(" Select values for ",-1)),l("span",kl,d(p.value||"..."),1)]),_(l("input",{"onUpdate:modelValue":e[10]||(e[10]=o=>C.value=o),type:"text",placeholder:"Search values...",class:"w-full md:w-64 border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[T,C.value]])]),l("div",Cl,[fe.value.length?c("",!0):(a(),s("div",Sl," No values found. ")),(a(!0),s(x,null,b(fe.value,o=>(a(),s("label",{key:`value-filter-${o}`,class:"flex items-center gap-2 px-4 py-2 border-b border-gray-100 last:border-b-0 cursor-pointer hover:bg-gray-50"},[_(l("input",{type:"checkbox",value:o,"onUpdate:modelValue":e[11]||(e[11]=r=>F.value=r)},null,8,Fl),[[ot,F.value]]),l("span",Nl,d(ke(o)),1)]))),128))]),e[40]||(e[40]=l("div",{class:"text-xs text-gray-500"},' Tip: values include blanks; "(Blank)" represents empty cells. ',-1))])):c("",!0),h.value==="empty"||h.value==="not_empty"?(a(),s("div",Vl," This filter matches rows where the selected column is "+d(h.value==="empty"?"blank":"not blank")+". ",1)):c("",!0),N.value?(a(),s("p",$l,d(N.value),1)):c("",!0),g.value.length?(a(),s("div",Pl,[e[41]||(e[41]=l("span",{class:"text-sm font-medium text-gray-700"},"Active filters:",-1)),(a(!0),s(x,null,b(g.value,o=>(a(),s("span",{key:o.id,class:"inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm bg-green-100 text-green-800 border border-green-200"},[m(d(Xe(o))+" ",1),l("button",{type:"button",onClick:r=>He(o.id),class:"text-xs text-green-600 hover:text-green-700 font-semibold"}," ✕ ",8,Ul)]))),128)),l("button",{type:"button",onClick:Ye,class:"text-sm text-green-700 hover:text-green-800 font-semibold"}," Clear all ")])):c("",!0)])):c("",!0),l("div",Al,[l("div",null,[e[42]||(e[42]=m("Total rows: ",-1)),l("span",Ll,d(f.value.length),1)]),l("div",null,[e[43]||(e[43]=m("Visible rows: ",-1)),l("span",El,d(te.value.length),1)]),l("div",null,[e[44]||(e[44]=m(" Protocol — Yes: ",-1)),l("span",Ml,d(me.value.yes),1),e[45]||(e[45]=m(", No: ",-1)),l("span",zl,d(me.value.no),1),e[46]||(e[46]=m(", N/A: ",-1)),l("span",Bl,d(me.value.na),1)])]),l("div",Il,[l("table",Rl,[l("thead",Dl,[l("tr",null,[(a(!0),s(x,null,b(E.value,o=>(a(),s("th",{key:o,class:"px-3 py-2 text-left font-medium text-gray-700 uppercase tracking-wide border-b border-gray-200 whitespace-nowrap"},[l("span",{title:o,class:ge(["block max-w-[180px] truncate",Ge(o)?"text-green-700 font-semibold":""])},d(o),11,Tl),pe(o)?(a(),s("span",ql," Required ")):c("",!0)]))),128)),e[47]||(e[47]=l("th",{class:"px-3 py-2 text-left font-medium text-gray-700 uppercase tracking-wide border-b border-gray-200"}," Actions ",-1))])]),l("tbody",jl,[(a(!0),s(x,null,b(te.value,o=>(a(),s("tr",{key:o.id,class:"hover:bg-gray-50"},[(a(!0),s(x,null,b(E.value,r=>(a(),s("td",{key:`${o.id}-${r}`,class:"px-3 py-2 align-top whitespace-nowrap"},[pe(r)?(a(),s("div",Ol,[(a(),s(x,null,b(Ne,y=>l("button",{key:y,type:"button",onClick:G=>qe(o,y),class:ge(["px-3 py-1 rounded-full text-xs font-medium border transition-colors cursor-pointer",_e(o)===y?y==="No"?"bg-red-600 text-white border-red-600":y==="Yes"?"bg-green-600 text-white border-green-600":"bg-gray-700 text-white border-gray-700":"bg-white text-gray-700 border-gray-300 hover:bg-gray-100"])},d(y),11,Hl)),64))])):Ie(r)?_((a(),s("input",{key:1,"onUpdate:modelValue":y=>o.data[r]=y,type:"text",class:"w-full border border-gray-300 rounded-md px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-green-500"},null,8,Yl)),[[T,o.data[r]]]):(a(),s("span",Gl,d(Re(o.data[r])),1))]))),128)),l("td",Kl,[l("button",{type:"button",onClick:r=>De(o.id),class:"text-sm text-red-600 hover:text-red-700 font-medium"}," Delete ",8,Ql)])]))),128)),te.value.length?c("",!0):(a(),s("tr",Jl,[l("td",{colspan:E.value.length+1,class:"px-3 py-6 text-center text-sm text-gray-500"}," No rows match your search. ",8,Wl)]))])])])])):c("",!0)])}}}),Zl=(K,q)=>{const $=K.__vccOpts||K;for(const[M,k]of q)$[M]=k;return $},oo=Zl(Xl,[["__scopeId","data-v-0d66d0ba"]]);export{oo as default};
