import{d as M,i as _,r as x,o as W,G as Q,c as d,a as e,f as C,n as P,t as p,k as w,e as f,h as i,q as E,A as U,B as V,s as L,j as v,v as b,z as D,F as N,b as q}from"./index-D6DdudHB.js";import{u as F}from"./whatsapp-DcciMMEC.js";const G={class:"space-y-4"},B={class:"flex items-center justify-between"},j={key:0,class:"border border-gray-200 rounded-lg p-4"},I={class:"flex justify-center"},z=["src"],O={key:1,class:"text-sm text-gray-500"},H={key:2,class:"text-sm text-green-600"},J={key:3,class:"text-sm text-gray-500"},K={key:4,class:"mt-4 flex gap-2"},X=["disabled"],Y=["disabled"],Z={key:5,class:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-md"},ee=M({__name:"WhatsAppStatus",setup($){const l=F(),o=_(()=>l.status),c=_(()=>l.connected),g=_(()=>l.qrCodeImage),n=x(!1),u=x(!1),h=_(()=>{switch(o.value){case"connected":return"Connected";case"authenticated":return"Authenticated";case"connecting":return"Connecting...";default:return"Disconnected"}});async function T(){var y,r;n.value=!0;try{await f.post("/api/whatsapp/restart"),setTimeout(()=>{l.fetchStatus(),l.fetchQRCode()},2e3),alert("WhatsApp connection restarted. Please wait for the QR code to appear.")}catch(a){alert("Error restarting WhatsApp: "+(((r=(y=a.response)==null?void 0:y.data)==null?void 0:r.error)||a.message))}finally{n.value=!1}}async function S(){var y,r;if(confirm("This will clear your WhatsApp session and require you to scan a new QR code. Continue?")){u.value=!0;try{await f.post("/api/whatsapp/logout"),setTimeout(()=>{l.fetchStatus(),l.fetchQRCode()},2e3),setTimeout(()=>{l.fetchStatus(),l.fetchQRCode()},5e3),setTimeout(()=>{l.fetchStatus(),l.fetchQRCode()},1e4),alert("Session cleared. A new QR code should appear in a few seconds. Please wait...")}catch(a){alert("Error clearing session: "+(((r=(y=a.response)==null?void 0:y.data)==null?void 0:r.error)||a.message))}finally{u.value=!1}}}return W(()=>{l.startPolling()}),Q(()=>{l.stopPolling()}),(y,r)=>(i(),d("div",G,[e("div",B,[e("div",null,[r[0]||(r[0]=e("p",{class:"text-sm font-medium text-gray-700"},"Status",-1)),e("p",{class:P(["mt-1 text-sm",c.value?"text-green-600":"text-red-600"])},p(h.value),3)]),e("div",{class:P(["h-3 w-3 rounded-full",c.value?"bg-green-500":"bg-red-500"])},null,2)]),o.value==="connecting"&&g.value?(i(),d("div",j,[r[1]||(r[1]=e("p",{class:"text-sm font-medium text-gray-700 mb-2"},"Scan QR Code with WhatsApp",-1)),e("div",I,[e("img",{src:g.value,alt:"QR Code",class:"max-w-xs"},null,8,z)]),r[2]||(r[2]=e("p",{class:"mt-2 text-xs text-gray-500 text-center"}," Open WhatsApp on your phone → Settings → Linked Devices → Link a Device ",-1))])):o.value==="connecting"?(i(),d("div",O," Waiting for QR code... ")):c.value?(i(),d("div",H," ✓ WhatsApp is connected and ready to send messages ")):(i(),d("div",J," WhatsApp is not connected. Please wait for the QR code to appear. ")),c.value?C("",!0):(i(),d("div",K,[e("button",{onClick:T,disabled:n.value||u.value,class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed cursor-pointer text-sm"},p(n.value?"Restarting...":"Restart Connection"),9,X),o.value==="connecting"&&!g.value?(i(),d("button",{key:0,onClick:S,disabled:n.value||u.value,class:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:bg-gray-400 disabled:cursor-not-allowed cursor-pointer text-sm"},p(u.value?"Clearing...":"Clear Session & Get New QR"),9,Y)):C("",!0)])),o.value==="connecting"&&!g.value?(i(),d("div",Z,[...r[3]||(r[3]=[e("p",{class:"text-sm text-yellow-800"},[e("strong",null,"Waiting for QR code..."),w(` This may take 10-30 seconds. If it doesn't appear, try clicking "Clear Session & Get New QR" to force a fresh connection. `)],-1)])])):C("",!0)]))}}),te={class:"px-4 py-6 sm:px-0"},se={class:"bg-white shadow rounded-lg p-6 mb-6"},ae={class:"bg-white shadow rounded-lg p-6 mb-6"},oe={class:"bg-white shadow rounded-lg p-6 mb-6"},le={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},re={class:"flex items-center"},ne={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},de={class:"border-t pt-4"},ie={class:"flex gap-2"},ue=["disabled"],pe={class:"flex gap-2"},me=["disabled"],ce={class:"bg-white shadow rounded-lg p-6"},ge={key:0,class:"text-sm text-gray-500"},ve={key:1,class:"space-y-4"},ye={class:"flex justify-between items-start"},be={class:"font-medium text-gray-900"},xe={class:"mt-2 text-sm text-gray-600 space-y-1"},fe=["onClick"],Se=M({__name:"Settings",setup($){const l=x([]),o=x({host:"",port:587,secure:!1,username:"",password:"",from_name:"",from_email:"",reply_to:""}),c=x(!1),g=x(!1),n=x(null),u=x("");W(async()=>{await h(),await S()});async function h(){try{const a=await f.get("/api/upload/mappings");l.value=a.data.mappings}catch(a){console.error("Error fetching mappings:",a)}}async function T(a){var t,m;if(confirm("Are you sure you want to delete this mapping?"))try{await f.delete(`/api/upload/mappings/${a}`),await h()}catch(s){alert("Error deleting mapping: "+(((m=(t=s.response)==null?void 0:t.data)==null?void 0:m.error)||s.message))}}async function S(){try{const a=await f.get("/api/settings/smtp");o.value={host:a.data.host||"",port:a.data.port||587,secure:a.data.secure===1||a.data.secure===!0,username:a.data.username||"",password:a.data.password||"",from_name:a.data.from_name||"",from_email:a.data.from_email||"",reply_to:a.data.reply_to||""}}catch(a){console.error("Error fetching SMTP settings:",a)}}async function y(){var a,t;c.value=!0,n.value=null;try{await f.post("/api/settings/smtp",o.value),alert("SMTP settings saved successfully!"),await S()}catch(m){alert("Error saving SMTP settings: "+(((t=(a=m.response)==null?void 0:a.data)==null?void 0:t.error)||m.message))}finally{c.value=!1}}async function r(){var m,s,A,R;if(!u.value||u.value.trim()===""){n.value={success:!1,message:"Please enter an email address to send the test email to."};return}const a=u.value.trim();if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a)){n.value={success:!1,message:"Please enter a valid email address."};return}g.value=!0,n.value=null;try{const k=await f.post("/api/email/test",{testEmail:a});n.value={success:!0,message:k.data.message||"Test email sent successfully!"}}catch(k){n.value={success:!1,message:((s=(m=k.response)==null?void 0:m.data)==null?void 0:s.error)||((R=(A=k.response)==null?void 0:A.data)==null?void 0:R.details)||"Failed to send test email"}}finally{g.value=!1}}return(a,t)=>{const m=V("router-link");return i(),d("div",te,[t[29]||(t[29]=e("div",{class:"mb-6"},[e("h2",{class:"text-3xl font-bold text-gray-900"},"Settings"),e("p",{class:"mt-1 text-sm text-gray-500"},"Manage WhatsApp connection and saved mappings")],-1)),e("div",se,[t[9]||(t[9]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"WhatsApp Connection",-1)),E(ee)]),e("div",ae,[t[11]||(t[11]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"WhatsApp Testing",-1)),t[12]||(t[12]=e("p",{class:"text-sm text-gray-500 mb-4"}," Test and inspect raw WhatsApp connection data returned by the backend. ",-1)),E(m,{to:"/whatsapp-test",class:"inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 cursor-pointer"},{default:U(()=>[...t[10]||(t[10]=[w(" Open WhatsApp Test Page ",-1)])]),_:1})]),e("div",oe,[t[26]||(t[26]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Email (SMTP) Settings",-1)),t[27]||(t[27]=e("p",{class:"text-sm text-gray-500 mb-4"}," Configure SMTP settings to send emails to contacts. For Gmail, use an App Password. ",-1)),e("form",{onSubmit:L(y,["prevent"]),class:"space-y-4"},[e("div",le,[e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"SMTP Host *",-1)),v(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>o.value.host=s),type:"text",required:"",class:"w-full border border-gray-300 rounded-md px-3 py-2",placeholder:"smtp.gmail.com"},null,512),[[b,o.value.host]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"SMTP Port *",-1)),v(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>o.value.port=s),type:"number",required:"",class:"w-full border border-gray-300 rounded-md px-3 py-2",placeholder:"587"},null,512),[[b,o.value.port,void 0,{number:!0}]])])]),e("div",null,[e("label",re,[v(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>o.value.secure=s),type:"checkbox",class:"mr-2"},null,512),[[D,o.value.secure]]),t[15]||(t[15]=e("span",{class:"text-sm font-medium text-gray-700"},"Use SSL/TLS (Direct SSL - for port 465)",-1))]),t[16]||(t[16]=e("p",{class:"mt-1 text-xs text-gray-500 ml-6"},[e("strong",null,"Checked:"),w(" Direct SSL/TLS connection (use with port 465)"),e("br"),e("strong",null,"Unchecked:"),w(" STARTTLS (use with port 587 - recommended for MailerSend and Gmail) ")],-1))]),e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Username/Email *",-1)),v(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>o.value.username=s),type:"text",required:"",class:"w-full border border-gray-300 rounded-md px-3 py-2",placeholder:"your-email@gmail.com"},null,512),[[b,o.value.username]])]),e("div",null,[t[18]||(t[18]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Password/App Password *",-1)),v(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>o.value.password=s),type:"password",required:"",class:"w-full border border-gray-300 rounded-md px-3 py-2",placeholder:"Enter password or App Password"},null,512),[[b,o.value.password]]),t[19]||(t[19]=e("p",{class:"mt-1 text-xs text-gray-500"},[w(" For Gmail, use an App Password. "),e("a",{href:"https://support.google.com/accounts/answer/185833",target:"_blank",class:"text-blue-600 hover:underline"},"Learn more")],-1))]),e("div",ne,[e("div",null,[t[20]||(t[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"From Name (optional)",-1)),v(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>o.value.from_name=s),type:"text",class:"w-full border border-gray-300 rounded-md px-3 py-2",placeholder:"RoboDoc"},null,512),[[b,o.value.from_name]])]),e("div",null,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"From Email (optional)",-1)),v(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>o.value.from_email=s),type:"email",class:"w-full border border-gray-300 rounded-md px-3 py-2",placeholder:"noreply@example.com"},null,512),[[b,o.value.from_email]])])]),e("div",null,[t[22]||(t[22]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Reply To (optional)",-1)),v(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>o.value.reply_to=s),type:"email",class:"w-full border border-gray-300 rounded-md px-3 py-2",placeholder:"reply@example.com"},null,512),[[b,o.value.reply_to]]),t[23]||(t[23]=e("p",{class:"mt-1 text-xs text-gray-500"}," Email address where replies should be sent. If not set, replies will go to the From Email. ",-1))]),e("div",de,[t[24]||(t[24]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Test Email Address",-1)),e("div",ie,[v(e("input",{"onUpdate:modelValue":t[8]||(t[8]=s=>u.value=s),type:"email",class:"flex-1 border border-gray-300 rounded-md px-3 py-2",placeholder:"Enter email address to send test email"},null,512),[[b,u.value]]),e("button",{type:"button",onClick:r,disabled:g.value||!u.value,class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed cursor-pointer whitespace-nowrap"},p(g.value?"Sending...":"Send Test Email"),9,ue)]),t[25]||(t[25]=e("p",{class:"mt-1 text-xs text-gray-500"},' Enter an email address and click "Send Test Email" to test your SMTP configuration. ',-1))]),e("div",pe,[e("button",{type:"submit",disabled:c.value,class:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed cursor-pointer"},p(c.value?"Saving...":"Save SMTP Settings"),9,me)]),n.value?(i(),d("div",{key:0,class:P(["p-3 rounded-md",n.value.success?"bg-green-50 text-green-800":"bg-red-50 text-red-800"])},p(n.value.message),3)):C("",!0)],32)]),e("div",ce,[t[28]||(t[28]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Saved Column Mappings",-1)),l.value.length===0?(i(),d("div",ge," No saved mappings yet. Create one when uploading a file. ")):(i(),d("div",ve,[(i(!0),d(N,null,q(l.value,s=>(i(),d("div",{key:s.id,class:"border border-gray-200 rounded-lg p-4"},[e("div",ye,[e("div",null,[e("h4",be,p(s.name),1),e("div",xe,[e("div",null,"Name: "+p(s.name_column||"-"),1),e("div",null,"Phone: "+p(s.phone_column||"-"),1),e("div",null,"Group: "+p(s.group_column||"-"),1),e("div",null,"Business: "+p(s.business_column||"-"),1)])]),e("button",{onClick:A=>T(s.id),class:"px-3 py-1 bg-red-600 text-white text-sm rounded-md hover:bg-red-700 cursor-pointer"}," Delete ",8,fe)])]))),128))]))])])}}});export{Se as default};
