import{d as $,r as d,o as N,C as A,e as f,c as r,a as e,f as c,t as l,F as B,b as P,n as j,x as R,h as n}from"./index-D6DdudHB.js";import{f as S}from"./phoneValidator-nfOHmQze.js";const F={class:"px-4 py-6 sm:px-0"},H={class:"mb-6 flex items-center gap-4"},L={key:0,class:"mt-1 text-sm text-gray-500"},G={key:0,class:"bg-white shadow rounded-lg p-6 mb-6"},V={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},z={class:"mt-1 text-lg font-semibold text-gray-900"},T={class:"mt-1 text-lg font-semibold text-gray-900"},U={class:"mt-1 text-lg font-semibold text-green-600"},q={key:0},J={class:"mt-1 text-lg font-semibold text-gray-900"},K={key:1},O={class:"mt-1 text-lg font-semibold text-gray-900"},Q={key:1,class:"text-center py-12"},W={key:2,class:"bg-white shadow rounded-lg overflow-hidden"},X={class:"px-6 py-4 border-b border-gray-200 flex justify-between items-center"},Y={class:"flex gap-2"},Z=["disabled"],ee={key:0,class:"px-6 py-12 text-center text-gray-500"},te={key:1,class:"divide-y divide-gray-200"},se={class:"flex items-start justify-between"},ae={class:"flex-1"},oe={class:"flex items-center gap-3 mb-2"},re={class:"text-sm text-gray-500"},ne={class:"mt-2"},le={class:"text-sm text-gray-900 whitespace-pre-wrap"},ie={key:0,class:"mt-2"},de={class:"text-sm text-red-600"},ce={class:"ml-4 flex gap-2"},ue=["onClick","disabled"],me=["onClick","disabled"],ge={key:2,class:"px-6 py-4 border-t border-gray-200 flex items-center justify-between"},pe={class:"text-sm text-gray-700"},ye={class:"flex gap-2"},fe=["disabled"],ve=["disabled"],_e=$({__name:"ContactHistory",setup(xe){const m=A();R();const i=d(null),g=d([]),b=d(!1),v=d(!1),u=d(!1),h=d(0),x=d(20),y=d(0);N(async()=>{const o=parseInt(m.params.id);o&&(await _(o),await p(o))});async function _(o){var t,s;try{const a=await f.get(`/api/contacts/${o}`);i.value=a.data.contact}catch(a){console.error("Error fetching contact:",a),alert("Error loading contact: "+(((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.error)||a.message))}}async function p(o){var t,s;b.value=!0;try{const a=await f.get("/api/messages/history",{params:{contactId:o,limit:x.value,offset:y.value}});g.value=a.data.messages,h.value=a.data.total}catch(a){console.error("Error fetching messages:",a),alert("Error loading messages: "+(((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.error)||a.message))}finally{b.value=!1}}function w(){const o=parseInt(m.params.id);y.value+=x.value,p(o)}function k(){const o=parseInt(m.params.id);y.value=Math.max(0,y.value-x.value),p(o)}async function C(o){var t,s;v.value=!0;try{await f.post(`/api/messages/retry/${o}`),alert("Message retried successfully");const a=parseInt(m.params.id);await p(a)}catch(a){alert("Error retrying message: "+(((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.error)||a.message))}finally{v.value=!1}}async function I(o){var t,s;if(confirm("Are you sure you want to delete this message?")){u.value=!0;try{await f.delete(`/api/messages/${o}`);const a=parseInt(m.params.id);await p(a),await _(a)}catch(a){alert("Error deleting message: "+(((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.error)||a.message))}finally{u.value=!1}}}async function M(){var t,s;const o=parseInt(m.params.id);if(confirm("Are you sure you want to delete all messages for this contact? This action cannot be undone.")){u.value=!0;try{await f.delete(`/api/messages/contact/${o}`),await p(o),await _(o),alert("All messages deleted successfully")}catch(a){alert("Error deleting messages: "+(((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.error)||a.message))}finally{u.value=!1}}}function E(o){return S(o)}function D(o){return o?new Date(o).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A"}return(o,t)=>(n(),r("div",F,[e("div",H,[e("button",{onClick:t[0]||(t[0]=s=>o.$router.back()),class:"p-2 text-gray-600 hover:text-gray-900 cursor-pointer",title:"Go back"},[...t[1]||(t[1]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1)])]),e("div",null,[t[2]||(t[2]=e("h2",{class:"text-3xl font-bold text-gray-900"},"Contact History",-1)),i.value?(n(),r("p",L," Message history for "+l(i.value.name),1)):c("",!0)])]),i.value?(n(),r("div",G,[e("div",V,[e("div",null,[t[3]||(t[3]=e("p",{class:"text-sm font-medium text-gray-500"},"Name",-1)),e("p",z,l(i.value.name),1)]),e("div",null,[t[4]||(t[4]=e("p",{class:"text-sm font-medium text-gray-500"},"Phone",-1)),e("p",T,l(E(i.value.phone)),1)]),e("div",null,[t[5]||(t[5]=e("p",{class:"text-sm font-medium text-gray-500"},"Messages Sent",-1)),e("p",U,l(i.value.sent_count||0),1)]),i.value.business?(n(),r("div",q,[t[6]||(t[6]=e("p",{class:"text-sm font-medium text-gray-500"},"Business",-1)),e("p",J,l(i.value.business),1)])):c("",!0),i.value.group_name?(n(),r("div",K,[t[7]||(t[7]=e("p",{class:"text-sm font-medium text-gray-500"},"Group",-1)),e("p",O,l(i.value.group_name),1)])):c("",!0)])])):c("",!0),b.value?(n(),r("div",Q,[...t[8]||(t[8]=[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),e("p",{class:"mt-2 text-gray-600"},"Loading message history...",-1)])])):(n(),r("div",W,[e("div",X,[t[9]||(t[9]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Message History",-1)),e("div",Y,[g.value.length>0?(n(),r("button",{key:0,onClick:M,disabled:u.value,class:"px-3 py-1 text-sm bg-red-600 text-white rounded-md hover:bg-red-700 disabled:bg-gray-400 disabled:cursor-not-allowed cursor-pointer"},l(u.value?"Deleting...":"Delete All"),9,Z)):c("",!0)])]),g.value.length===0?(n(),r("div",ee," No messages found for this contact ")):(n(),r("div",te,[(n(!0),r(B,null,P(g.value,s=>(n(),r("div",{key:s.id,class:"px-6 py-4 hover:bg-gray-50"},[e("div",se,[e("div",ae,[e("div",oe,[e("span",{class:j([{"bg-green-100 text-green-800":s.status==="sent"||s.status==="success","bg-yellow-100 text-yellow-800":s.status==="pending","bg-red-100 text-red-800":s.status==="failed"},"px-2 py-1 text-xs font-medium rounded-full"])},l(s.status),3),e("span",re,l(D(s.sent_at)),1)]),e("div",ne,[t[10]||(t[10]=e("p",{class:"text-sm font-medium text-gray-700 mb-1"},"Message:",-1)),e("p",le,l(s.final_message),1)]),s.error_message?(n(),r("div",ie,[t[11]||(t[11]=e("p",{class:"text-sm font-medium text-red-700 mb-1"},"Error:",-1)),e("p",de,l(s.error_message),1)])):c("",!0)]),e("div",ce,[s.status==="failed"?(n(),r("button",{key:0,onClick:a=>C(s.id),disabled:v.value,class:"px-3 py-1 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed cursor-pointer"},l(v.value?"Retrying...":"Retry"),9,ue)):c("",!0),e("button",{onClick:a=>I(s.id),disabled:u.value,class:"px-3 py-1 text-sm bg-red-600 text-white rounded-md hover:bg-red-700 disabled:bg-gray-400 disabled:cursor-not-allowed cursor-pointer"}," Delete ",8,me)])])]))),128))])),h.value>0?(n(),r("div",ge,[e("div",pe," Showing "+l(g.value.length)+" of "+l(h.value)+" messages ",1),e("div",ye,[e("button",{onClick:k,disabled:y.value===0,class:"px-3 py-1 border border-gray-300 rounded-md disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer"}," Previous ",8,fe),e("button",{onClick:w,disabled:g.value.length<x.value,class:"px-3 py-1 border border-gray-300 rounded-md disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer"}," Next ",8,ve)])])):c("",!0)]))]))}});export{_e as default};
